{"version":3,"sources":["mavo.js"],"names":["_toConsumableArray","arr","Array","isArray","i","arr2","length","from","$","$$","_","self","Mavo","Class","constructor","element","_this","this","treeBuilt","defer","index","all","push","dataMv","attributes","map","attribute","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","join","concat","Symbol","iterator","next","done","_element","value","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","getAttribute","setAttribute","err","id","unhandled","classList","contains","autoEdit","storage","Functions","urlOption","source","trim","Backend","create","permissions","Permissions","addEventListener","evt","keyCode","superKey","preventDefault","save","selectors","primitive","forEach","hasChildren","not","formControl","property","defaults","Primitive","getDefaults","isCollection","is","getValueAttribute","ui","bar","className","start","status","inside","authControls","can","loginHash","login","tag","href","textContent","events","click","after","location","hash","history","replaceState","document","title","URL","window","remove","unbind","backend","innerHTML","contents","name","e","logout","target","activeElement","needsEdit","hooks","run","root","Group","resolve","setUnsavedChanges","onchange","_ref","action","split","filter","a","edit","onclick","editing","mouseenter focus","add","mouseleave blur","revert","disabled","clear","appendChild","cannot","read","load","on","fire","off","debouncedSave","debounce","callback","node","saved","requestAnimationFrame","removeEventListener","data","getData","o","toJSON","arguments","error","message","closeTimeout","close","transition","opacity","then","mouseenter","clearTimeout","mouseleave","rr","setTimeout","_len","log","_key","_console","console","apply","render","context","unsavedChanges","_this2","confirm","store","matches","item","closest","toggle","type","parent","parentNode","walk","obj","_this3","inProgress","ready","get","Promise","reject","response","JSON","parse","xhr","_this4","put","file","_this5","dataString","lastSaved","Date","now","live","toggleAttribute","static","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","mavo","navigator","platform","indexOf","init","container","documentElement","Hooks","s","specificProperty","group","multiple","tr","option","selector","or","selector1","selector2","and","ret","s1","s2","andNot","extend","rootGroup","output","include","Intl","Stretchy","Bliss"],"mappings":"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","file":"mavo.min.js","sourcesContent":["(function ($, $$) {\n\n\"use strict\";\n\nvar _ = self.Mavo = $.Class({\n\tconstructor: function (element) {\n\t\tthis.treeBuilt = Mavo.defer();\n\n\t\tthis.element = element;\n\n\t\t// Index among other mavos in the page, 1 is first\n\t\tthis.index = _.all.push(this);\n\n\t\t// Convert any data-mv-* attributes to mv-*\n\t\tvar dataMv = _.attributes.map(attribute => `[data-${attribute}]`);\n\t\tfor (let element of $$(dataMv.join(\", \"), this.element).concat(this.element)) {\n\t\t\tfor (let attribute of _.attributes) {\n\t\t\t\tlet value = element.getAttribute(\"data-\" + attribute);\n\n\t\t\t\tif (value !== null) {\n\t\t\t\t\telement.setAttribute(attribute, value);\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\t// Assign a unique (for the page) id to this mavo instance\n\t\tthis.id = Mavo.getAttribute(this.element, \"mv-app\", \"id\") || `mavo${this.index}`;\n\t\tthis.element.setAttribute(\"mv-app\", this.id);\n\n\t\tthis.unhandled = this.element.classList.contains(\"mv-keep-unhandled\");\n\t\tthis.autoEdit = this.element.classList.contains(\"mv-autoedit\");\n\n\t\tif (this.index == 1) {\n\t\t\tthis.storage = _.Functions.urlOption(\"store\");\n\t\t\tthis.source = _.Functions.urlOption(\"source\");\n\t\t}\n\n\t\tthis.storage = this.storage || _.Functions.urlOption(`${this.id}_store`) || this.element.getAttribute(\"mv-storage\") || null;\n\t\tthis.source = this.source || _.Functions.urlOption(`${this.id}_source`) || this.element.getAttribute(\"mv-init\") || null;\n\n\t\tif (this.storage) {\n\t\t\tthis.storage = this.storage.trim();\n\n\t\t\tthis.storage = this.storage == \"none\"? null : _.Backend.create(this.storage, this);\n\t\t}\n\n\t\tif (this.source) {\n\t\t\tthis.source = _.Backend.create(this.source, this);\n\t\t}\n\n\t\tthis.permissions = this.storage ? this.storage.permissions : new Mavo.Permissions();\n\n\t\t// Ctrl + S or Cmd + S to save\n\t\tthis.element.addEventListener(\"keydown\", evt => {\n\t\t\tif (evt.keyCode == 83 && evt[_.superKey]) {\n\t\t\t\tevt.preventDefault();\n\t\t\t\tthis.save();\n\t\t\t}\n\t\t});\n\n\t\tthis.element.setAttribute(\"typeof\", \"\");\n\n\t\t// Apply heuristic for groups\n\t\t$$(_.selectors.primitive, element).forEach(element => {\n\t\t\tvar hasChildren = $(`${_.selectors.not(_.selectors.formControl)}, ${_.selectors.property}`, element);\n\n\t\t\tif (hasChildren) {\n\t\t\t\tvar defaults = Mavo.Primitive.getDefaults(element);\n\t\t\t\tvar isCollection = Mavo.is(\"multiple\", element);\n\n\t\t\t\tif (isCollection || !Mavo.Primitive.getValueAttribute(element, defaults) && !defaults.hasChildren) {\n\t\t\t\t\telement.setAttribute(\"typeof\", \"\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.ui = {\n\t\t\tbar: $(\".mv-bar\", this.element) || $.create({\n\t\t\t\tclassName: \"mv-bar mv-ui\",\n\t\t\t\tstart: this.element\n\t\t\t})\n\t\t};\n\n\t\tthis.ui.status = $(\".mv-status\", this.ui.bar) || $.create(\"span\", {\n\t\t\tclassName: \"mv-status\",\n\t\t\tinside: this.ui.bar\n\t\t});\n\n\t\tif (this.storage) {\n\t\t\t// Reflect backend permissions in global permissions\n\t\t\tthis.authControls = {};\n\n\t\t\tthis.permissions.can(\"login\", () => {\n\t\t\t\t// #login authenticates if only 1 mavo on the page, or if the first.\n\t\t\t\t// Otherwise, we have to generate a slightly more complex hash\n\t\t\t\tthis.loginHash = \"#login\" + (Mavo.all[0] === this? \"\" : \"-\" + this.id);\n\n\t\t\t\tthis.authControls.login = $.create({\n\t\t\t\t\ttag: \"a\",\n\t\t\t\t\thref: this.loginHash,\n\t\t\t\t\ttextContent: \"Login\",\n\t\t\t\t\tclassName: \"mv-login mv-button\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: evt => {\n\t\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t\t\tthis.storage.login();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tafter: $(\".mv-status\", this.ui.bar)\n\t\t\t\t});\n\n\t\t\t\t// We also support a hash to trigger login, in case the user doesn't want visible login UI\n\t\t\t\tvar login;\n\t\t\t\t(login = () => {\n\t\t\t\t\tif (location.hash === this.loginHash) {\n\t\t\t\t\t\t// This just does location.hash = \"\" without getting a pointless # at the end of the URL\n\t\t\t\t\t\thistory.replaceState(null, document.title, new URL(\"\", location) + \"\");\n\t\t\t\t\t\tthis.storage.login();\n\t\t\t\t\t}\n\t\t\t\t})();\n\t\t\t\twindow.addEventListener(\"hashchange.mavo\", login);\n\t\t\t}, () => {\n\t\t\t\t$.remove(this.authControls.login);\n\t\t\t\tthis.element._.unbind(\"hashchange.mavo\");\n\t\t\t});\n\n\t\t\t// Update login status\n\t\t\tthis.element.addEventListener(\"mavo:login.mavo\", evt => {\n\t\t\t\tif (evt.backend == this.storage) { // ignore logins from source backend\n\t\t\t\t\tvar status = $(\".mv-status\", this.ui.bar);\n\t\t\t\t\tstatus.innerHTML = \"\";\n\t\t\t\t\tstatus._.contents([\n\t\t\t\t\t\t\"Logged in to \" + evt.backend.id + \" as \",\n\t\t\t\t\t\t{tag: \"strong\", innerHTML: evt.name},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\t\ttextContent: \"Logout\",\n\t\t\t\t\t\t\tclassName: \"mv-logout\",\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: e => evt.backend.logout()\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.element.addEventListener(\"mavo:logout.mavo\", evt => {\n\t\t\t\t$(\".mv-status\", this.ui.bar).textContent = \"\";\n\t\t\t});\n\t\t}\n\n\t\t// Prevent editing properties inside <summary> to open and close the summary (fix bug #82)\n\t\tif ($(\"summary [property]:not([typeof])\")) {\n\t\t\tthis.element.addEventListener(\"click\", evt => {\n\t\t\t\tif (evt.target != document.activeElement) {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\n\t\t// Is there any control that requires an edit button?\n\t\tthis.needsEdit = false;\n\n\t\t// Build mavo objects\n\t\tMavo.hooks.run(\"init-tree-before\", this);\n\n\t\tthis.root = new Mavo.Group(this.element, this);\n\t\tthis.treeBuilt.resolve();\n\n\t\tMavo.hooks.run(\"init-tree-after\", this);\n\n\t\tthis.setUnsavedChanges(false);\n\n\t\tthis.permissions.onchange(({action, value}) => {\n\t\t\tvar permissions = this.element.getAttribute(\"mv-permissions\") || \"\";\n\t\t\tpermissions = permissions.trim().split(/\\s+/).filter(a => a != action);\n\n\t\t\tif (value) {\n\t\t\t\tpermissions.push(action);\n\t\t\t}\n\n\t\t\tthis.element.setAttribute(\"mv-permissions\", permissions.join(\" \"));\n\t\t});\n\n\t\tthis.permissions.can([\"edit\", \"add\", \"delete\"], () => {\n\t\t\tthis.ui.edit = $.create(\"button\", {\n\t\t\t\tclassName: \"mv-edit\",\n\t\t\t\ttextContent: \"Edit\",\n\t\t\t\tonclick: e => this.editing? this.done() : this.edit(),\n\t\t\t\tinside: this.ui.bar\n\t\t\t});\n\n\t\t\tif (this.autoEdit) {\n\t\t\t\tthis.ui.edit.click();\n\t\t\t}\n\t\t}, () => { // cannot\n\t\t\t$.remove(this.ui.edit);\n\n\t\t\tif (this.editing) {\n\t\t\t\tthis.done();\n\t\t\t}\n\t\t});\n\n\t\tif (this.needsEdit) {\n\t\t\tthis.permissions.can(\"save\", () => {\n\t\t\t\tthis.ui.save = $.create(\"button\", {\n\t\t\t\t\tclassName: \"mv-save\",\n\t\t\t\t\ttextContent: \"Save\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: e => this.save(),\n\t\t\t\t\t\t\"mouseenter focus\": e => {\n\t\t\t\t\t\t\tthis.element.classList.add(\"mv-highlight-unsaved\");\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"mouseleave blur\": e => this.element.classList.remove(\"mv-highlight-unsaved\")\n\t\t\t\t\t},\n\t\t\t\t\tinside: this.ui.bar\n\t\t\t\t});\n\n\t\t\t\tthis.ui.revert = $.create(\"button\", {\n\t\t\t\t\tclassName: \"mv-revert\",\n\t\t\t\t\ttextContent: \"Revert\",\n\t\t\t\t\tdisabled: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: e => this.revert(),\n\t\t\t\t\t\t\"mouseenter focus\": e => {\n\t\t\t\t\t\t\tthis.element.classList.add(\"mv-highlight-unsaved\");\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"mouseleave blur\": e => this.element.classList.remove(\"mv-highlight-unsaved\")\n\t\t\t\t\t},\n\t\t\t\t\tinside: this.ui.bar\n\t\t\t\t});\n\t\t\t}, () => {\n\t\t\t\t$.remove([this.ui.save, this.ui.revert]);\n\t\t\t\tthis.ui.save = this.ui.revert = null;\n\t\t\t});\n\t\t}\n\n\t\tthis.permissions.can(\"delete\", () => {\n\t\t\tthis.ui.clear = $.create(\"button\", {\n\t\t\t\tclassName: \"mv-clear\",\n\t\t\t\ttextContent: \"Clear\",\n\t\t\t\tonclick: e => this.clear()\n\t\t\t});\n\n\t\t\tthis.ui.bar.appendChild(this.ui.clear);\n\t\t});\n\n\t\tthis.permissions.cannot([\"delete\", \"edit\"], () => {\n\t\t\t$.remove(this.ui.clear);\n\t\t});\n\n\t\tif (this.storage || this.source) {\n\t\t\t// Fetch existing data\n\t\t\tif (!this.storage) {\n\t\t\t\tthis.source.permissions.can(\"read\", () => this.permissions.read = true);\n\t\t\t}\n\n\t\t\tthis.permissions.can(\"read\", () => this.load());\n\t\t}\n\t\telse {\n\t\t\t// No storage\n\t\t\tthis.permissions.on([\"read\", \"edit\"]);\n\n\t\t\t$.fire(this.element, \"mavo:load\");\n\t\t}\n\n\t\tif (!this.needsEdit) {\n\t\t\tthis.permissions.off([\"edit\", \"add\", \"delete\"]);\n\n\t\t\t// If there's no edit mode, we must save immediately when properties change\n\t\t\tthis.element.addEventListener(\"mavo:load\", evt => {\n\t\t\t\tvar debouncedSave = _.debounce(() => {\n\t\t\t\t\tthis.save();\n\t\t\t\t}, 3000);\n\n\t\t\t\tvar callback = evt => {\n\t\t\t\t\tif (evt.node.saved) {\n\t\t\t\t\t\tdebouncedSave();\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tthis.permissions.can(\"save\", () => {\n\t\t\t\t\t\tthis.element.addEventListener(\"mavo:datachange\", callback);\n\t\t\t\t\t}, () => {\n\t\t\t\t\t\tthis.element.removeEventListener(\"mavo:datachange\", callback);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tMavo.hooks.run(\"init-end\", this);\n\t},\n\n\tget editing() {\n\t\treturn this.root.editing;\n\t},\n\n\tget data() {\n\t\treturn this.getData();\n\t},\n\n\tgetData: function(o) {\n\t\treturn this.root.getData(o);\n\t},\n\n\ttoJSON: function(data = this.data) {\n\t\treturn _.toJSON(data);\n\t},\n\n\terror: function(message, ...log) {\n\t\tvar close = () => $.transition(error, {opacity: 0}).then($.remove);\n\t\tvar closeTimeout;\n\t\tvar error = $.create(\"p\", {\n\t\t\tclassName: \"mv-error mv-ui\",\n\t\t\tcontents: [\n\t\t\t\tmessage,\n\t\t\t\t{\n\t\t\t\t\ttag: \"button\",\n\t\t\t\t\tclassName: \"mv-close mv-ui\",\n\t\t\t\t\ttextContent: \"×\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\t\"click\": close\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t\tevents: {\n\t\t\t\tmouseenter: e => clearTimeout(closeTimeout),\n\t\t\t\tmouseleave: _.rr(e => closeTimeout = setTimeout(close, 5000))\n\t\t\t},\n\t\t\tstart: this.element\n\t\t});\n\n\t\t// Log more info for programmers\n\t\tif (log.length > 0) {\n\t\t\tconsole.log(\"%c\" + message, \"color: red; font-weight: bold\", ...log);\n\t\t}\n\t},\n\n\trender: function(data) {\n\t\t_.hooks.run(\"render-start\", {context: this, data});\n\n\t\tif (data) {\n\t\t\tif (this.editing) { // TODO this logic should go to Node\n\t\t\t\tthis.done();\n\t\t\t\tthis.root.render(data);\n\t\t\t\tthis.edit();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.root.render(data);\n\t\t\t}\n\n\t\t}\n\n\t\tthis.unsavedChanges = false;\n\t},\n\n\tclear: function() {\n\t\tif (confirm(\"This will delete all your data. Are you sure?\")) {\n\t\t\tthis.store(null).then(() => this.root.clear());\n\t\t}\n\t},\n\n\tedit: function() {\n\t\tthis.root.edit();\n\n\t\t$.events(this.element, \"mouseenter.mavo:edit mouseleave.mavo:edit\", evt => {\n\t\t\tif (evt.target.matches(\".mv-item-controls *\")) {\n\t\t\t\tvar item = evt.target.closest(_.selectors.item);\n\t\t\t\titem.classList.toggle(\"mv-highlight\", evt.type == \"mouseenter\");\n\t\t\t}\n\n\t\t\tif (evt.target.matches(_.selectors.item)) {\n\t\t\t\tevt.target.classList.remove(\"mv-has-hovered-item\");\n\n\t\t\t\tvar parent = evt.target.parentNode.closest(_.selectors.item);\n\n\t\t\t\tif (parent) {\n\t\t\t\t\tparent.classList.toggle(\"mv-has-hovered-item\", evt.type == \"mouseenter\");\n\t\t\t\t}\n\t\t\t}\n\t\t}, true);\n\n\t\tthis.setUnsavedChanges();\n\t},\n\n\t/**\n\t * Set this mavo instance’s unsavedChanges flag.\n\t * @param {Boolean} [value]\n\t *        If true, just sets the flag to true, no traversal.\n\t *        If false, sets the flag of the Mavo instance and every tree node to false\n\t *        If not provided, traverses the tree and recalculates the flag value.\n\t */\n\tsetUnsavedChanges: function(value) {\n\t\tvar unsavedChanges = !!value;\n\n\t\tif (!value) {\n\t\t\tthis.walk(obj => {\n\t\t\t\tif (obj.unsavedChanges) {\n\t\t\t\t\tunsavedChanges = true;\n\n\t\t\t\t\tif (value === false) {\n\t\t\t\t\t\tobj.unsavedChanges = false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn this.unsavedChanges = unsavedChanges;\n\t},\n\n\t// Conclude editing\n\tdone: function() {\n\t\tthis.root.done();\n\t\t$.unbind(this.element, \".mavo:edit\");\n\t\tthis.unsavedChanges = false;\n\t},\n\n\t/**\n\t * load - Fetch data from source and render it.\n\t *\n\t * @return {Promise}  A promise that resolves when the data is loaded.\n\t */\n\tload: function() {\n\t\tthis.inProgress = \"Loading\";\n\n\t\tvar backend = this.storage || this.source;\n\n\t\treturn backend.ready.then(() => backend.get())\n\t\t.catch(err => {\n\t\t\t// Try again with source\n\t\t\tif (this.source && backend !== this.source) {\n\t\t\t\treturn this.source.ready.then(() => this.source.get());\n\t\t\t}\n\n\t\t\treturn Promise.reject(err);\n\t\t})\n\t\t.then(response => {\n\t\t\tif (response && $.type(response) == \"string\") {\n\t\t\t\ttry {\n\t\t\t\t\tresponse = JSON.parse(response);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tthis.error(\"The data is corrupted.\", e, response);\n\t\t\t\t\tresponse = \"\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.render(response);\n\t\t})\n\t\t.catch(err => {\n\t\t\tif (err) {\n\t\t\t\tif (err.xhr && err.xhr.status == 404) {\n\t\t\t\t\tthis.render(\"\");\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.error(\"The data could not be loaded.\", err);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\t.then(() => {\n\t\t\tthis.inProgress = false;\n\t\t\t$.fire(this.element, \"mavo:load\");\n\t\t});\n\t},\n\n\tstore: function() {\n\t\tif (!this.storage) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.inProgress = \"Saving\";\n\n\t\treturn this.storage.login()\n\t\t.then(() => this.storage.put())\n\t\t.then(file => {\n\t\t\tthis.inProgress = false;\n\t\t\treturn file;\n\t\t})\n\t\t.catch(err => {\n\t\t\tif (err) {\n\t\t\t\tthis.error(\"Problem saving data\", err);\n\t\t\t}\n\n\t\t\tthis.inProgress = false;\n\t\t\treturn Promise.reject(err);\n\t\t});\n\t},\n\n\tsave: function() {\n\t\treturn this.store().then(file => {\n\t\t\tif (file) {\n\t\t\t\t$.fire(this.element, \"mavo:save\", {\n\t\t\t\t\tdata: file.data,\n\t\t\t\t\tdataString: file.dataString\n\t\t\t\t});\n\n\t\t\t\tthis.lastSaved = Date.now();\n\t\t\t\tthis.root.save();\n\t\t\t\tthis.unsavedChanges = false;\n\t\t\t}\n\t\t});\n\t},\n\n\trevert: function() {\n\t\tthis.root.revert();\n\t},\n\n\twalk: function(callback) {\n\t\tthis.root.walk(callback);\n\t},\n\n\tlive: {\n\t\tinProgress: function(value) {\n\t\t\t$.toggleAttribute(this.element, \"mv-progress\", value, value);\n\t\t},\n\n\t\tunsavedChanges: function(value) {\n\t\t\tthis.element.classList.toggle(\"mv-unsaved-changes\", value);\n\n\t\t\tif (this.ui && this.ui.save) {\n\t\t\t\tthis.ui.save.classList.toggle(\"mv-unsaved-changes\", value);\n\t\t\t\tthis.ui.revert.disabled = !value;\n\t\t\t}\n\t\t},\n\n\t\tneedsEdit: function(value) {\n\t\t\t$.toggleAttribute(this.ui.bar, \"hidden\", \"\", !value);\n\t\t}\n\t},\n\n\tstatic: {\n\t\tall: [],\n\n\t\tget: function(id) {\n\t\t\tfor (let mavo of _.all) {\n\t\t\t\tif (mavo.id === id) {\n\t\t\t\t\treturn mavo;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\n\t\tsuperKey: navigator.platform.indexOf(\"Mac\") === 0? \"metaKey\" : \"ctrlKey\",\n\n\t\tinit: function(container) {\n\t\t\treturn $$(_.selectors.init, container || document)\n\t\t\t\t.filter(element => element == document.documentElement || !element.parentNode.closest(_.selectors.init))\n\t\t\t\t.map(element => new _(element));\n\t\t},\n\n\t\thooks: new $.Hooks(),\n\n\t\tattributes: [\n\t\t\t\"mv-app\", \"mv-storage\", \"mv-init\", \"mv-attribute\",\n\t\t\t\"mv-default\", \"mv-mode\", \"mv-edit\", \"mv-permisssions\"\n\t\t]\n\t}\n});\n\n{\n\nlet s = _.selectors = {\n\tinit: \".mv-app, [mv-app], [data-mv-app], [mv-storage], [data-mv-storage]\",\n\tproperty: \"[property], [itemprop]\",\n\tspecificProperty: name => `[property=${name}], [itemprop=${name}]`,\n\tgroup: \"[typeof], [itemscope], [itemtype], .mv-group\",\n\tmultiple: \"[mv-multiple], .mv-multiple\",\n\tformControl: \"input, select, option, textarea\",\n\titem: \".mv-item\",\n\tui: \".mv-ui\",\n\tcontainer: {\n\t\t// \"li\": \"ul, ol\",\n\t\t\"tr\": \"table\",\n\t\t\"option\": \"select\",\n\t\t// \"dt\": \"dl\",\n\t\t// \"dd\": \"dl\"\n\t}\n};\n\nlet arr = s.arr = selector => selector.split(/\\s*,\\s*/g);\nlet not = s.not = selector => arr(selector).map(s => `:not(${s})`).join(\"\");\nlet or = s.or = (selector1, selector2) => selector1 + \", \" + selector2;\nlet and = s.and = (selector1, selector2) => {\n\tvar ret = [], arr2 = arr(selector2);\n\n\tarr(selector1).forEach(s1 => ret.push(...arr2.map(s2 => s1 + s2)));\n\n\treturn ret.join(\", \");\n};\nlet andNot = s.andNot = (selector1, selector2) => and(selector1, not(selector2));\n\n$.extend(_.selectors, {\n\tprimitive: andNot(s.property, s.group),\n\trootGroup: andNot(s.group, s.property),\n\toutput: or(s.specificProperty(\"output\"), \".mv-output, .mv-value\")\n});\n\n}\n\n// Init mavo\nPromise.all([\n\t$.ready(),\n\t$.include(Array.from && window.Intl && document.documentElement.closest, \"https://cdn.polyfill.io/v2/polyfill.min.js?features=blissfuljs,Intl.~locale.en\")\n])\n.catch(err => console.error(err))\n.then(() => Mavo.init());\n\nStretchy.selectors.filter = \".mv-editor:not([property])\";\n\n})(Bliss, Bliss.$);\n"],"sourceRoot":"/source/"}