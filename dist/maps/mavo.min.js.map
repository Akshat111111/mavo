{"version":3,"sources":["collection.js"],"names":["$","$$","Mavo","attributes","push","_","Collection","Class","extends","Node","nodeType","constructor","element","mavo","o","_this","this","templateElement","children","fromTemplate","properties","selectors","property","map","getProperty","mutable","matches","multiple","accepts","getAttribute","split","cloneNode","item","createItem","add","itemTemplate","template","constant","permissions","can","dragulaContainer","marker","parentNode","hooks","run","length","containsTemplate","getData","arguments","undefined","env","context","options","data","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","value","deleted","itemData","err","unhandled","before","concat","after","create","collection","type","index","get","adopt","bottomUp","nextItem","currentIndex","indexOf","splice","i","_item","silent","dataChanged","unsavedChanges","_this2","walk","obj","closestCollection","copies","delete","hard","_this3","remove","transition","opacity","then","style","edit","call","addButton","tag","tagName","toLowerCase","containerSelector","container","closest","clear","propagate","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","childNodes","action","save","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","_item2","propagated","revert","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","_item3","render","_this4","toArray","fragment","document","createDocumentFragment","forEach","datum","appendChild","insertBefore","slice","find","items","filter","ret","flatten","isCompatible","c","live","_mutable","needsEdit","createComment","MavoCollection","classList","lazy","order","test","compareDocumentPosition","DOCUMENT_POSITION_FOLLOWING","parent","_this5","selector","group","button","contains","className","textContent","name","addEventListener","evt","preventDefault","static","dragula","drake","containers","_dragula","apply","toString","include","self","moves","el","target","source","previous","previousElementSibling","lastElementChild","console","log","on","closestItem","cancel","_this6","attribute","swapUI","callback","sneak","ui","inside","descriptor","Object","getOwnPropertyDescriptor","prototype","defineProperty","_this7","set","_this8","_this9","itemControls","contents","title","events","click","replace","getClosestCollection","parentGroup","_this10","toggle","elementContents","node","_deleted","isDeleted","Bliss"],"mappings":"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","file":"mavo.min.js","sourcesContent":["(function($, $$) {\n\nMavo.attributes.push(\"mv-multiple\", \"mv-order\", \"mv-accepts\");\n\nvar _ = Mavo.Collection = $.Class({\n\textends: Mavo.Node,\n\tnodeType: \"Collection\",\n\tconstructor: function (element, mavo, o) {\n\t\t/*\n\t\t * Create the template, remove it from the DOM and store it\n\t\t */\n\t\tthis.templateElement = this.element;\n\n\t\tthis.children = [];\n\n\t\t// ALL descendant property names as an array\n\t\tif (!this.fromTemplate(\"properties\", \"mutable\", \"templateElement\", \"accepts\")) {\n\t\t\tthis.properties = $$(Mavo.selectors.property, this.templateElement).map(Mavo.Node.getProperty);\n\t\t\tthis.mutable = this.templateElement.matches(Mavo.selectors.multiple);\n\t\t\tthis.accepts = (this.templateElement.getAttribute(\"mv-accepts\") || \"\").split(/\\s+/);\n\n\t\t\t// Must clone because otherwise once expressions are parsed on the template element\n\t\t\t// we will not be able to pick them up from subsequent items\n\t\t\tthis.templateElement = this.templateElement.cloneNode(true);\n\t\t}\n\n\t\tif (this.mutable) {\n\t\t\tvar item = this.createItem(this.element);\n\t\t\tthis.add(item);\n\t\t\tthis.itemTemplate = item.template || item;\n\n\t\t\tif (!this.constant) {\n\t\t\t\tthis.mavo.permissions.can([\"edit\", \"add\", \"delete\"], () => {\n\t\t\t\t\t_.dragulaContainer(this.marker.parentNode);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tMavo.hooks.run(\"collection-init-end\", this);\n\t},\n\n\tget length() {\n\t\treturn this.children.length;\n\t},\n\n\t// Collection still contains its template as data\n\tget containsTemplate() {\n\t\treturn this.children.length && this.children[0].element === this.element;\n\t},\n\n\tgetData: function(o = {}) {\n\t\tvar env = {\n\t\t\tcontext: this,\n\t\t\toptions: o,\n\t\t\tdata: []\n\t\t};\n\n\t\tfor (item of this.children) {\n\t\t\tif (!item.deleted) {\n\t\t\t\tlet itemData = item.getData(env.options);\n\n\t\t\t\tif (itemData) {\n\t\t\t\t\tenv.data.push(itemData);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.unhandled && env.options.unhandled) {\n\t\t\tenv.data = this.unhandled.before.concat(env.data, this.unhandled.after);\n\t\t}\n\n\t\tif (!this.mutable && env.data.length == 1) {\n\t\t\t// See https://github.com/LeaVerou/mavo/issues/50#issuecomment-266079652\n\t\t\tenv.data = env.data[0];\n\t\t}\n\n\t\tMavo.hooks.run(\"node-getdata-end\", env);\n\n\t\treturn env.data;\n\t},\n\n\t// Create item but don't insert it anywhere\n\t// Mostly used internally\n\tcreateItem: function (element) {\n\t\tif (!element) {\n\t\t\telement = this.templateElement.cloneNode(true);\n\t\t}\n\n\t\tvar item = Mavo.Node.create(element, this.mavo, {\n\t\t\tcollection: this,\n\t\t\ttemplate: this.itemTemplate || (this.template? this.template.itemTemplate : null),\n\t\t\tproperty: this.property,\n\t\t\ttype: this.type\n\t\t});\n\n\t\treturn item;\n\t},\n\n\t/**\n\t * Add a new item to this collection\n\t * @param item {Node|Mavo.Node} Optional. Element or Mavo object for the new item\n\t * @param index {Number} Optional. Index of existing item, will be added opposite to list direction\n\t * @param silent {Boolean} Optional. Throw a datachange event? Mainly used internally.\n\t */\n\tadd: function(item, index, o = {}) {\n\t\tif (item instanceof Node) {\n\t\t\titem = Mavo.Node.get(item) || this.createItem(item);\n\t\t}\n\t\telse {\n\t\t\titem = item || this.createItem();\n\t\t}\n\n\t\tif (item.collection != this) {\n\t\t\tthis.adopt(item);\n\t\t}\n\n\t\tif (index in this.children) {\n\t\t\tif (this.bottomUp) {\n\t\t\t\tindex++;\n\t\t\t}\n\t\t}\n\t\telse if (index === undefined) {\n\t\t\tindex = this.bottomUp? 0 : this.length;\n\t\t}\n\n\t\tif (!item.element.parentNode) {\n\t\t\t// Add it to the DOM, if not already in\n\t\t\tvar nextItem = this.children[index];\n\n\t\t\titem.element._.before(nextItem && nextItem.element || this.marker);\n\t\t}\n\n\t\t// Update internal data model\n\t\tvar currentIndex = this.children.indexOf(item);\n\t\tif (currentIndex > -1) {\n\t\t\tthis.children.splice(currentIndex, 1);\n\t\t}\n\n\t\tthis.children.splice(index, 0, item);\n\n\n\t\tfor (let i = index - 1; i < this.length; i++) {\n\t\t\tlet item = this.children[i];\n\n\t\t\tif (item) {\n\t\t\t\titem.index = i;\n\n\t\t\t\tif (!o.silent) {\n\t\t\t\t\titem.dataChanged(\"add\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!o.silent) {\n\t\t\tthis.unsavedChanges = item.unsavedChanges = this.mavo.unsavedChanges = true;\n\t\t}\n\n\t\treturn item;\n\t},\n\n\tadopt: function(item) {\n\t\tif (item.collection) {\n\t\t\t// It belongs to another collection, delete from there first\n\t\t\titem.collection.children.splice(item.collection.children.indexOf(item), 1);\n\t\t\titem.collection.dataChanged(\"delete\");\n\t\t}\n\n\t\t // Update collection & closestCollection properties\n\t\tthis.walk(obj => {\n\t\t\tif (obj.closestCollection === item.collection) {\n\t\t\t\tobj.closestCollection = this;\n\t\t\t}\n\n\t\t\t// Belongs to another Mavo?\n\t\t\tif (item.mavo != this.mavo) {\n\t\t\t\titem.mavo = this.mavo;\n\t\t\t}\n\t\t});\n\n\t\titem.collection = this;\n\n\t\t// Adjust templates and their copies\n\t\tif (item.template) {\n\t\t\tMavo.delete(item.template.copies, item);\n\n\t\t\titem.template = this.itemTemplate;\n\t\t}\n\t},\n\n\tdelete: function(item, hard) {\n\t\tif (hard) {\n\t\t\t// Hard delete\n\t\t\t$.remove(item.element);\n\t\t\tthis.children.splice(this.children.indexOf(item), 1);\n\t\t\treturn;\n\t\t}\n\n\t\treturn $.transition(item.element, {opacity: 0}).then(() => {\n\t\t\titem.deleted = true; // schedule for deletion\n\t\t\titem.element.style.opacity = \"\";\n\n\t\t\titem.dataChanged(\"delete\");\n\n\t\t\tthis.unsavedChanges = item.unsavedChanges = this.mavo.unsavedChanges = true;\n\t\t});\n\t},\n\n\tedit: function() {\n\t\tthis.super.edit.call(this);\n\n\t\tif (this.mutable) {\n\t\t\t// Insert the add button if it's not already in the DOM\n\t\t\tif (!this.addButton.parentNode) {\n\t\t\t\tif (this.bottomUp) {\n\t\t\t\t\tthis.addButton._.before($.value(this.children[0], \"element\") || this.marker);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvar tag = this.element.tagName.toLowerCase();\n\t\t\t\t\tvar containerSelector = Mavo.selectors.container[tag];\n\n\t\t\t\t\tif (containerSelector) {\n\t\t\t\t\t\tvar after = this.marker.parentNode.closest(containerSelector);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.addButton._.after(after && after.parentNode? after : this.marker);\n\n\t\t\t\t\t_.dragulaContainer(this.addButton.parentNode);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tdone: function() {\n\t\tthis.super.done.call(this);\n\n\t\tif (this.mutable) {\n\t\t\tif (this.addButton.parentNode) {\n\t\t\t\tthis.addButton.remove();\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Delete all items in the collection.\n\t */\n\tclear: function() {\n\t\tif (this.mutable) {\n\t\t\tthis.propagate(item => {\n\t\t\t\tif (item.element.remove) {\n\t\t\t\t\titem.element.remove();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Document fragment, remove all children\n\t\t\t\t\tfor (let node of item.element.childNodes) {\n\t\t\t\t\t\tnode => node.remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.children = [];\n\n\t\t\tthis.dataChanged(\"clear\");\n\t\t}\n\t},\n\n\tdataChanged: function(action, o = {}) {\n\t\to.element = o.element || this.marker;\n\t\treturn this.super.dataChanged.call(this, action, o);\n\t},\n\n\tsave: function() {\n\t\tfor (let item of this.children) {\n\t\t\tif (item.deleted) {\n\t\t\t\tthis.delete(item, true);\n\t\t\t}\n\t\t\telse {\n\t\t\t\titem.unsavedChanges = false;\n\t\t\t}\n\t\t}\n\t},\n\n\tpropagated: [\"save\"],\n\n\trevert: function() {\n\t\tfor (let item of this.children) {\n\t\t\t// Delete added items\n\t\t\tif (item.unsavedChanges) {\n\t\t\t\tthis.delete(item, true);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Bring back deleted items\n\t\t\t\tif (item.deleted) {\n\t\t\t\t\titem.deleted = false;\n\t\t\t\t}\n\n\t\t\t\t// Revert all properties\n\t\t\t\titem.revert();\n\t\t\t}\n\t\t}\n\t},\n\n\trender: function(data) {\n\t\tthis.unhandled = {before: [], after: []};\n\n\t\tif (!data) {\n\t\t\treturn;\n\t\t}\n\n\t\tdata = Mavo.toArray(data);\n\n\t\tif (!this.mutable) {\n\t\t\tthis.children.forEach((item, i) => item.render(data && data[i]));\n\n\t\t\tif (data) {\n\t\t\t\tthis.unhandled.after = data.slice(this.children.length);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tthis.clear();\n\n\t\t\t// Using document fragments improved rendering performance by 60%\n\t\t\tvar fragment = document.createDocumentFragment();\n\n\t\t\tdata.forEach((datum, i) => {\n\t\t\t\tvar item = this.createItem();\n\n\t\t\t\titem.render(datum);\n\n\t\t\t\tthis.children.push(item);\n\t\t\t\titem.index = i;\n\n\t\t\t\tfragment.appendChild(item.element);\n\t\t\t});\n\n\t\t\tthis.marker.parentNode.insertBefore(fragment, this.marker);\n\t\t}\n\n\t\tthis.save();\n\t},\n\n\tfind: function(property) {\n\t\tvar items = this.children.filter(item => !item.deleted);\n\n\t\tif (this.property == property) {\n\t\t\treturn items;\n\t\t}\n\n\t\tif (this.properties.indexOf(property) > -1) {\n\t\t\tvar ret = items.map(item => item.find(property));\n\n\t\t\treturn Mavo.flatten(ret);\n\t\t}\n\t},\n\n\tisCompatible: function(c) {\n\t\treturn c === this\n\t\t       || c.template == this || this.template == c || this.template == c.template\n\t\t       || this.accepts.indexOf(c.property) > -1;\n\t},\n\n\tlive: {\n\t\tmutable: function(value) {\n\t\t\tif (value && value !== this.mutable) {\n\t\t\t\t// Why is all this code here? Because we want it executed\n\t\t\t\t// every time mutable changes, not just in the constructor\n\t\t\t\t// (think multiple elements with the same property name, where only one has mv-multiple)\n\t\t\t\tthis._mutable = value;\n\n\t\t\t\tthis.mavo.needsEdit = true;\n\n\t\t\t\t// Keep position of the template in the DOM, since we might remove it\n\t\t\t\tthis.marker = document.createComment(\"mv-marker\");\n\t\t\t\tthis.marker._.MavoCollection = this;\n\t\t\t\t$.after(this.marker, this.templateElement);\n\n\t\t\t\tthis.templateElement.classList.add(\"mv-item\");\n\t\t\t}\n\t\t}\n\t},\n\n\tlazy: {\n\t\tbottomUp: function() {\n\t\t\t/*\n\t\t\t * Add new items at the top or bottom?\n\t\t\t */\n\n\t\t\tif (!this.mutable) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar order = this.templateElement.getAttribute(\"mv-order\");\n\t\t\tif (order !== null) {\n\t\t\t\t// Attribute has the highest priority and overrides any heuristics\n\t\t\t\treturn /^desc\\b/i.test(order);\n\t\t\t}\n\n\t\t\tif (!this.addButton.parentNode) {\n\t\t\t\t// If add button not in DOM, do the default\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// If add button is already in the DOM and *before* our template, then we default to prepending\n\t\t\treturn !!(this.addButton.compareDocumentPosition(this.templateElement) & Node.DOCUMENT_POSITION_FOLLOWING);\n\t\t},\n\n\t\tclosestCollection: function() {\n\t\t\tvar parent = this.marker? this.marker.parentNode : this.templateElement.parentNode;\n\n\t\t\treturn parent.closest(Mavo.selectors.item);\n\t\t},\n\n\t\taddButton: function() {\n\t\t\t// Find add button if provided, or generate one\n\t\t\tvar selector = `button.mv-add-${this.property}`;\n\t\t\tvar group = this.closestCollection || this.marker.parentNode.closest(Mavo.selectors.group);\n\n\t\t\tif (group) {\n\t\t\t\tvar button = $$(selector, group).filter(button => {\n\t\t\t\t\treturn !this.templateElement.contains(button);\n\t\t\t\t})[0];\n\t\t\t}\n\n\t\t\tif (!button) {\n\t\t\t\tbutton = $.create(\"button\", {\n\t\t\t\t\tclassName: \"mv-add\",\n\t\t\t\t\ttextContent: \"Add \" + this.name\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tbutton.classList.add(\"mv-ui\", \"mv-add\");\n\t\t\tbutton._.data.MavoCollection = this;\n\n\t\t\tif (this.property) {\n\t\t\t\tbutton.classList.add(`mv-add-${this.property}`);\n\t\t\t}\n\n\t\t\tbutton.addEventListener(\"click\", evt => {\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tthis.add().edit();\n\t\t\t});\n\n\t\t\treturn button;\n\t\t}\n\t},\n\n\tstatic: {\n\t\tget: element => {\n\t\t\t// Is it an add button or a marker?\n\t\t\tvar collection = $.value(element, $.property, \"MavoCollection\");\n\n\t\t\tif (collection) {\n\t\t\t\treturn collection;\n\t\t\t}\n\n\t\t\t// Maybe it's a collection item?\n\t\t\tvar item = Mavo.Node.get(element);\n\n\t\t\treturn item && item.collection || null;\n\t\t},\n\n\t\tdragulaContainer: element => {\n\t\t\t_.dragula.then(() => {\n\t\t\t\tif (_.drake.containers.indexOf(element) === -1) {\n\t\t\t\t\t_.drake.containers.push(element);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tlazy: {\n\t\t\tdragula: () => {\n\t\t\t\treturn $.include(self.dragula, \"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.2/dragula.min.js\").then(() => {\n\t\t\t\t\t_.drake = _.drake || dragula({\n\t\t\t\t\t\tmoves: function (el, container, target) {\n\t\t\t\t\t\t\treturn target.classList.contains(\"mv-drag-handle\") &&\n\t\t\t\t\t\t\t\t   target.closest(Mavo.selectors.item) === el;\n\t\t\t\t\t\t},\n\t\t\t\t\t\taccepts: function(el, target, source, next) {\n\t\t\t\t\t\t\tif (el.contains(target)) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar previous = next? next.previousElementSibling : target.lastElementChild;\n\n\t\t\t\t\t\t\tvar collection = _.get(previous) || _.get(next);\n\n\t\t\t\t\t\t\tif (!collection) {\n\t\t\t\t\t\t\t\tconsole.log(next, previous);\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn Mavo.Node.get(el).collection.isCompatible(collection);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// TODO prevent being dropped in the wrong positions\n\t\t\t\t\t_.drake.on(\"drop\", (el, target, source, next) => {\n\n\t\t\t\t\t\tvar item = Mavo.Node.get(el);\n\t\t\t\t\t\tvar oldIndex = item && item.index;\n\t\t\t\t\t\tvar previous = el.previousElementSibling;\n\t\t\t\t\t\tvar collection = _.get(previous) || _.get(next);\n\t\t\t\t\t\tvar closestItem = Mavo.Node.get(previous) || Mavo.Node.get(next);\n\n\t\t\t\t\t\tif (closestItem && closestItem.collection != collection) {\n\t\t\t\t\t\t\tclosestItem = null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (item.collection.isCompatible(collection)) {\n\t\t\t\t\t\t\tif (closestItem) {\n\t\t\t\t\t\t\t\tvar index = closestItem.index + (closestItem.element === previous);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t// Collection is empty and/or we dragged on the Add button\n\t\t\t\t\t\t\t\tvar index = collection.children.length;\n\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\tcollection.add(item, index);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\treturn _.drake.cancel(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n\nMavo.hooks.add(\"primitive-init-end\", function() {\n\tif (this.collection && !this.attribute) {\n\t\t// Collection of primitives, deal with setting textContent etc without the UI interfering.\n\t\tvar swapUI = callback => {\n\t\t\tvar ret;\n\n\t\t\tthis.sneak(() => {\n\t\t\t\tvar ui = $.remove($(\".mv-item-controls\", this.element));\n\n\t\t\t\tret = callback();\n\n\t\t\t\t$.inside(ui, this.element);\n\t\t\t});\n\n\t\t\treturn ret;\n\t\t};\n\n\t\t// Intercept certain properties so that any Mavo UI inside this primitive will not be destroyed\n\t\t[\"textContent\", \"innerHTML\"].forEach(property => {\n\t\t\tvar descriptor = Object.getOwnPropertyDescriptor(Node.prototype, property);\n\n\t\t\tObject.defineProperty(this.element, property, {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn swapUI(() => descriptor.get.call(this));\n\t\t\t\t},\n\n\t\t\t\tset: function(value) {\n\t\t\t\t\tswapUI(() => descriptor.set.call(this, value));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n\nMavo.hooks.add(\"node-edit-end\", function() {\n\tif (this.collection) {\n\t\tif (!this.itemControls) {\n\t\t\tthis.itemControls = $$(\".mv-item-controls\", this.element)\n\t\t\t\t\t\t\t\t   .filter(el => el.closest(Mavo.selectors.item) == this.element)[0];\n\n\t\t\tthis.itemControls = this.itemControls || $.create({\n\t\t\t\tclassName: \"mv-item-controls mv-ui\"\n\t\t\t});\n\n\t\t\t$.set(this.itemControls, {\n\t\t\t\tcontents: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\ttitle: \"Delete this \" + this.name,\n\t\t\t\t\t\tclassName: \"mv-delete\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\"click\": evt => this.collection.delete(this)\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\ttitle: `Add new ${this.name.replace(/s$/i, \"\")} ${this.bottomUp? \"after\" : \"before\"}`,\n\t\t\t\t\t\tclassName: \"mv-add\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\"click\": evt => this.collection.add(null, this.children.indexOf(item)).edit()\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\ttitle: \"Drag to reorder \" + this.name,\n\t\t\t\t\t\tclassName: \"mv-drag-handle\"\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t\t}\n\n\t\tif (!this.itemControls.parentNode) {\n\t\t\tthis.element.appendChild(this.itemControls);\n\t\t}\n\t}\n});\n\nMavo.hooks.add(\"node-done-end\", function() {\n\tif (this.collection) {\n\t\tif (this.itemControls) {\n\t\t\tthis.itemControls.remove();\n\t\t}\n\t}\n});\n\nMavo.Node.prototype.getClosestCollection = function() {\n\treturn this.collection ||\n\t\t   this.group.collection ||\n\t\t   (this.parentGroup? this.parentGroup.closestCollection : null);\n};\n\n$.lazy(Mavo.Node.prototype, \"closestCollection\", function() {\n\treturn this.getClosestCollection();\n});\n\n$.live(Mavo.Node.prototype, \"deleted\", function(value) {\n\tthis.element.classList.toggle(\"mv-deleted\", value);\n\n\tif (value) {\n\t\t// Soft delete, store element contents in a fragment\n\t\t// and replace them with an undo prompt.\n\t\tthis.elementContents = document.createDocumentFragment();\n\t\t$$(this.element.childNodes).forEach(node => {\n\t\t\tthis.elementContents.appendChild(node);\n\t\t});\n\n\t\t$.contents(this.element, [\n\t\t\t{\n\t\t\t\ttag: \"button\",\n\t\t\t\tclassName: \"mv-close mv-ui\",\n\t\t\t\ttextContent: \"×\",\n\t\t\t\tevents: {\n\t\t\t\t\t\"click\": function(evt) {\n\t\t\t\t\t\t$.remove(this.parentNode);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"Deleted \" + this.name,\n\t\t\t{\n\t\t\t\ttag: \"button\",\n\t\t\t\tclassName: \"mv-undo mv-ui\",\n\t\t\t\ttextContent: \"Undo\",\n\t\t\t\tevents: {\n\t\t\t\t\t\"click\": evt => this.deleted = false\n\t\t\t\t}\n\t\t\t}\n\t\t]);\n\n\t\tthis.element.classList.remove(\"mv-delete-hover\");\n\t}\n\telse if (this.deleted) {\n\t\t// Undelete\n\t\tthis.element.textContent = \"\";\n\t\tthis.element.appendChild(this.elementContents);\n\n\t\t// otherwise expressions won't update because this will still seem as deleted\n\t\t// Alternatively, we could fire datachange with a timeout.\n\t\tthis._deleted = false;\n\n\t\tthis.dataChanged(\"undelete\");\n\t}\n});\n\n/**\n * Check if this unit is either deleted or inside a deleted group\n */\nMavo.Node.prototype.isDeleted = function() {\n\tvar ret = this.deleted;\n\n\tif (this.deleted) {\n\t\treturn true;\n\t}\n\n\treturn !!this.parentGroup && this.parentGroup.isDeleted();\n};\n\nMavo.hooks.add(\"node-init-end\", function(env) {\n\tthis.collection = env.options.collection;\n\n\tif (this.collection) {\n\t\t// This is a collection item\n\t\tthis.group = this.parentGroup = this.collection.parentGroup;\n\t}\n});\n\n})(Bliss, Bliss.$);\n"],"sourceRoot":"/source/"}