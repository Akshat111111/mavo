{"version":3,"sources":["debug.js"],"names":["_typeof","Symbol","iterator","obj","constructor","$","$$","_","Mavo","Debug","friendlyError","e","expr","type","name","replace","toLowerCase","message","test","elementLabel","element","attribute","ret","nodeName","hasAttribute","getAttribute","id","classList","length","map","c","join","printValue","Array","isArray","Object","keys","Primitive","value","Collection","children","Group","timed","callback","console","time","apply","this","arguments","timeEnd","callee","objName","eval","before","performance","now","timeTaken","calls","all","push","times","table","o","Function","Time (ms)","Calls","reservedWords","split","prototype","render","selectors","debug","selector","Stretchy","filter","hooks","add","root","store","contains","create","className","contents","tag","textContent","after","addEventListener","evt","innerHTML","appendChild","prettyPrint","data","_ref","backend","walkUp","group","Functions","urlOption","closest","inside","style","display","mv-expressions","collection","remove","env","exception","expression","debugRow","_ref2","_ref2$attribute","undefined","_ref2$tds","tds","parentNode","title","events","mouseenter mouseleave","toggle","click","scrollIntoView","behavior","td","Node","setAttribute","_this","parsed","forEach","Expression","matches","input","target","nextElementSibling","update","once","focus","resize","_this2","andNot","multiple","property","propagate","indexOf","tr","cells","Bliss"],"mappings":"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","file":"mavo.min.js","sourcesContent":["(function($, $$) {\n\nvar _ = Mavo.Debug = {\n\tfriendlyError: (e, expr) => {\n\t\tvar type = e.constructor.name.replace(/Error$/, \"\").toLowerCase();\n\t\tvar message = e.message;\n\n\t\t// Friendlify common errors\n\n\t\t// Non-developers don't know wtf a token is.\n\t\tmessage = message.replace(/\\s+token\\s+/g, \" \");\n\n\t\tif (message == \"Unexpected }\" && !/[{}]/.test(expr)) {\n\t\t\tmessage = \"Missing a )\";\n\t\t}\n\t\telse if (message === \"Unexpected )\") {\n\t\t\tmessage = \"Missing a (\";\n\t\t}\n\t\telse if (message === \"Invalid left-hand side in assignment\") {\n\t\t\tmessage = \"Invalid assignment. Maybe you typed = instead of == ?\";\n\t\t}\n\t\telse if (message == \"Unexpected ILLEGAL\") {\n\t\t\tmessage = \"There is an invalid character somewhere.\";\n\t\t}\n\n\t\treturn `<span class=\"type\">Oh noes, a ${type} error!</span> ${message}`;\n\t},\n\n\telementLabel: function(element, attribute) {\n\t\tvar ret = element.nodeName.toLowerCase();\n\n\t\tif (element.hasAttribute(\"property\")) {\n\t\t\tret += `[property=${element.getAttribute(\"property\")}]`;\n\t\t}\n\t\telse if (element.id) {\n\t\t\tret += `#${element.id}`;\n\t\t}\n\t\telse if (element.classList.length) {\n\t\t\tret += $$(element.classList).map(c => `.${c}`).join(\"\");\n\t\t}\n\n\t\tif (attribute) {\n\t\t\tret += `@${attribute}`;\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\tprintValue: function(obj) {\n\t\tvar ret;\n\n\t\tif (typeof obj !== \"object\" || obj === null) {\n\t\t\treturn typeof obj == \"string\"? `\"${obj}\"` : obj + \"\";\n\t\t}\n\n\t\tif (Array.isArray(obj)) {\n\t\t\tif (obj.length > 0) {\n\t\t\t\tif (typeof obj[0] === \"object\") {\n\t\t\t\t\treturn `List: ${obj.length} group(s)`;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn \"List: \" + obj.map(_.printValue).join(\", \");\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn \"List: (Empty)\";\n\t\t\t}\n\t\t}\n\n\t\tif (obj.constructor === Object) {\n\t\t\treturn `Group with ${Object.keys(obj).length} properties`;\n\t\t}\n\n\t\tif (obj instanceof Mavo.Primitive) {\n\t\t\treturn _.printValue(obj.value);\n\t\t}\n\t\telse if (obj instanceof Mavo.Collection) {\n\t\t\tif (obj.children.length > 0) {\n\t\t\t\tif (obj.children[0] instanceof Mavo.Group) {\n\t\t\t\t\treturn `List: ${obj.children.length} group(s)`;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn \"List: \" + obj.children.map(_.printValue).join(\", \");\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn _.printValue([]);\n\t\t\t}\n\t\t}\n\t\telse if (obj instanceof Mavo.Group) {\n\t\t\t// Group\n\t\t\treturn `Group with ${Object.keys(obj).length} properties`;\n\t\t}\n\t},\n\n\ttimed: function(id, callback) {\n\t\treturn function() {\n\t\t\tconsole.time(id);\n\t\t\tcallback.apply(this, arguments);\n\t\t\tconsole.timeEnd(id);\n\t\t};\n\t},\n\n\ttime: function callee(objName, name) {\n\t\tvar obj = eval(objName);\n\t\tvar callback = obj[name];\n\n\t\tobj[name] = function callee() {\n\t\t\tvar before = performance.now();\n\t\t\tvar ret = callback.apply(this, arguments);\n\t\t\tcallee.timeTaken += performance.now() - before;\n\t\t\tobj[name].calls++;\n\t\t\treturn ret;\n\t\t};\n\n\t\tobj[name].timeTaken = obj[name].calls = 0;\n\n\t\tcallee.all = callee.all || [];\n\t\tcallee.all.push({obj, objName, name});\n\n\t\treturn obj[name];\n\t},\n\n\ttimes: function() {\n\t\tif (!_.time.all) {\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.table(_.time.all.map(o => {\n\t\t\treturn {\n\t\t\t\t\"Function\": `${o.objName}.${o.name}`,\n\t\t\t\t\"Time (ms)\": o.obj[o.name].timeTaken,\n\t\t\t\t\"Calls\": o.obj[o.name].calls\n\t\t\t};\n\t\t}));\n\t},\n\n\treservedWords: \"as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield\".split(\"|\")\n};\n\nMavo.prototype.render = _.timed(\"render\", Mavo.prototype.render);\n\nMavo.selectors.debug = \".mv-debug\";\n\nvar selector = \", .mv-debuginfo\";\n\nStretchy.selectors.filter += selector;\n\n// Add element to show saved data\nMavo.hooks.add(\"init-tree-after\", function() {\n\tif (this.root.debug) {\n\t\tthis.element.classList.add(\"mv-debug-saving\");\n\t}\n\n\tif (this.store && this.element.classList.contains(\"mv-debug-saving\")) {\n\t\tvar element;\n\n\t\tvar details = $.create(\"details\", {\n\t\t\tclassName: \"mv-debug-storage\",\n\t\t\tcontents: [\n\t\t\t\t{tag: \"Summary\", textContent: \"Saved data\"},\n\t\t\t\telement = $.create(\"pre\", {id: this.id + \"-debug-storage\"})\n\t\t\t],\n\t\t\tafter: this.element\n\t\t});\n\n\t\tthis.element.addEventListener(\"mavo:save\", evt => {\n\t\t\telement.innerHTML = \"\";\n\n\t\t\telement.appendChild(prettyPrint(evt.data));\n\t\t});\n\t}\n});\n\nMavo.hooks.add(\"render-start\", function({data}) {\n\tif (this.backend && this.element.classList.contains(\"mv-debug-saving\")) {\n\t\tvar element = $(`#${this.id}-debug-storage`);\n\n\t\tif (element) {\n\t\t\telement.innerHTML = \"\";\n\n\t\t\tif (data) {\n\t\t\t\telement.appendChild(prettyPrint(data));\n\t\t\t}\n\t\t}\n\t}\n});\n\nMavo.hooks.add(\"group-init-start\", function() {\n\tthis.debug = this.debug || this.walkUp(group => {\n\t\tif (group.debug) {\n\t\t\treturn true;\n\t\t}\n\t}) || Mavo.Functions.urlOption(\"debug\") !== null;\n\n\tif (!this.debug && this.element.closest(Mavo.selectors.debug)) {\n\t\tthis.debug = true;\n\t}\n\n\tif (this.debug) {\n\t\tthis.debug = $.create(\"tbody\", {\n\t\t\tinside: $.create(\"table\", {\n\t\t\t\tinnerHTML: `<thead><tr>\n\t\t\t\t\t<th></th>\n\t\t\t\t\t<th>Expression</th>\n\t\t\t\t\t<th>Value</th>\n\t\t\t\t\t<th>Element</th>\n\t\t\t\t</tr></thead>`,\n\t\t\t\tstyle: {\n\t\t\t\t\tdisplay: \"none\"\n\t\t\t\t},\n\t\t\t\tinside: $.create(\"details\", {\n\t\t\t\t\tclassName: \"mv-ui mv-debuginfo\",\n\t\t\t\t\tinside: this.element,\n\t\t\t\t\tcontents: $.create(\"summary\", {\n\t\t\t\t\t\ttextContent: \"Debug\"\n\t\t\t\t\t}),\n\t\t\t\t\t\"mv-expressions\": \"none\"\n\t\t\t\t})\n\t\t\t})\n\t\t});\n\t}\n}, true);\n\nMavo.hooks.add(\"node-init-end\", function() {\n\tif (this.collection) {\n\t\tthis.debug = this.collection.debug;\n\t}\n});\n\nMavo.hooks.add(\"expressions-init-start\", function() {\n\tthis.debug = this.group.debug;\n});\n\nMavo.hooks.add(\"expression-eval-beforeeval\", function() {\n\tif (this.debug) {\n\t\tthis.debug.classList.remove(\"mv-error\");\n\t}\n});\n\nMavo.hooks.add(\"expression-eval-error\", function(env) {\n\tif (this.debug) {\n\t\tthis.debug.innerHTML = _.friendlyError(env.exception, env.expression);\n\t\tthis.debug.classList.add(\"mv-error\");\n\t}\n});\n\nMavo.Group.prototype.debugRow = function({element, attribute = null, tds = []}) {\n\tif (!this.debug) {\n\t\treturn;\n\t}\n\n\tthis.debug.parentNode.style.display = \"\";\n\n\tvar type = tds[0];\n\n\ttds[0] = $.create(\"td\", {\n\t\ttitle: type\n\t});\n\n\tif (!tds[3]) {\n\t\tvar elementLabel = _.elementLabel(element, attribute);\n\n\t\ttds[3] = $.create(\"td\", {\n\t\t\ttextContent: elementLabel,\n\t\t\ttitle: elementLabel,\n\t\t\tevents: {\n\t\t\t\t\"mouseenter mouseleave\": evt => {\n\t\t\t\t\telement.classList.toggle(\"mv-highlight\", evt.type === \"mouseenter\");\n\t\t\t\t},\n\t\t\t\t\"click\": evt => {\n\t\t\t\t\telement.scrollIntoView({behavior: \"smooth\"});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\ttds = tds.map(td => {\n\t\tif (!(td instanceof Node)) {\n\t\t\treturn $.create(\"td\", typeof td == \"object\"? td : { textContent: td });\n\t\t}\n\n\t\treturn td;\n\t});\n\n\tif (type == \"Warning\") {\n\t\ttds[1].setAttribute(\"colspan\", 2);\n\t}\n\n\tvar tr = $.create(\"tr\", {\n\t\tclassName: \"mv-debug-\" + type.toLowerCase(),\n\t\tcontents: tds,\n\t\tinside: this.debug\n\t});\n};\n\nMavo.hooks.add(\"expressiontext-init-end\", function() {\n\tif (this.group.debug) {\n\t\tthis.debug = {};\n\n\t\tthis.parsed.forEach(expr => {\n\t\t\tif (expr instanceof Mavo.Expression && !this.element.matches(\".mv-debuginfo *\")) {\n\t\t\t\tthis.group.debugRow({\n\t\t\t\t\telement: this.element,\n\t\t\t\t\tattribute: this.attribute,\n\t\t\t\t\ttds: [\"Expression\", {\n\t\t\t\t\t\t\ttag: \"td\",\n\t\t\t\t\t\t\tcontents: {\n\t\t\t\t\t\t\t\ttag: \"textarea\",\n\t\t\t\t\t\t\t\tvalue: expr.expression,\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tinput: evt => {\n\t\t\t\t\t\t\t\t\t\texpr.expression = evt.target.value;\n\t\t\t\t\t\t\t\t\t\texpr.debug = evt.target.parentNode.nextElementSibling;\n\t\t\t\t\t\t\t\t\t\tthis.update(this.data);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tonce: {\n\t\t\t\t\t\t\t\t\tfocus: evt => Stretchy.resize(evt.target)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\texpr.debug = $.create(\"td\")\n\t\t\t\t\t]\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n\nMavo.hooks.add(\"group-init-end\", function() {\n\t// TODO make properties update, collapse duplicate expressions\n\tif (this.debug instanceof Node) {\n\t\t// We have a debug table, add stuff to it\n\n\t\tvar selector = Mavo.selectors.andNot(Mavo.selectors.multiple, Mavo.selectors.property);\n\t\t$$(selector, this.element).forEach(element => {\n\t\t\tthis.debugRow({\n\t\t\t\telement,\n\t\t\t\ttds: [\"Warning\", \"mv-multiple without a property attribute\"]\n\t\t\t});\n\t\t});\n\n\t\tthis.propagate(obj => {\n\t\t\tvar value = _.printValue(obj);\n\n\t\t\tthis.debugRow({\n\t\t\t\telement: obj.element,\n\t\t\t\ttds: [\"Property\", obj.property, obj.value]\n\t\t\t});\n\n\t\t\tif (_.reservedWords.indexOf(obj.property) > -1) {\n\t\t\t\tthis.debugRow({\n\t\t\t\t\telement: obj.element,\n\t\t\t\t\ttds: [\"Warning\", `You can’t use \"${obj.property}\" as a property name, it’s a reserved word.`]\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (/^\\d|[\\W$]/.test(obj.property)) {\n\t\t\t\tthis.debugRow({\n\t\t\t\t\telement: obj.element,\n\t\t\t\t\ttds: [\"Warning\", {\n\t\t\t\t\t\ttextContent: `You can’t use \"${obj.property}\" as a property name.`,\n\t\t\t\t\t\ttitle: \"Property names can only contain letters, numbers and underscores and cannot start with a number.\"\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.group.element.addEventListener(\"mavo:datachange\", evt => {\n\t\t\t$$(\"tr.debug-property\", this.debug).forEach(tr => {\n\t\t\t\tvar property = tr.cells[1].textContent;\n\t\t\t\tvar value = _.printValue(this.children[property]);\n\n\t\t\t\tif (tr.cells[2]) {\n\t\t\t\t\tvar td = tr.cells[2];\n\t\t\t\t\ttd.textContent = td.title = value;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n\nMavo.hooks.add(\"expressiontext-update-beforeeval\", function(env) {\n\tif (this.debug) {\n\t\tenv.td = env.expr.debug;\n\n\t\tif (env.td) {\n\t\t\tenv.td.classList.remove(\"mv-error\");\n\t\t}\n\t}\n});\n\nMavo.hooks.add(\"expressiontext-update-aftereval\", function(env) {\n\tif (env.td && !env.td.classList.contains(\"mv-error\")) {\n\t\tvar value = _.printValue(env.value);\n\t\tenv.td.textContent = env.td.title = value;\n\t}\n});\n\n// Mavo.Debug.time(\"Mavo.Expressions.prototype\", \"update\");\n\n})(Bliss, Bliss.$);\n"],"sourceRoot":"/source/"}