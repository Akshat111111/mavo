{"version":3,"sources":["node.js"],"names":["_toConsumableArray","arr","Array","isArray","i","arr2","length","from","$","$$","_","Mavo","Node","Class","abstract","constructor","element","mavo","_this","this","o","arguments","undefined","Error","uid","maxId","template","copies","push","fromTemplate","property","getProperty","type","Group","normalize","store","getAttribute","views","viewObserver","Observer","records","console","log","target","view","group","parentGroup","hooks","run","editing","constant","isRoot","name","readable","toLowerCase","data","getData","saved","walk","callback","walker","obj","ret","propagate","walkUp","call","_len","args","_key","apply","concat","edit","done","unbind","children","node","propagated","toJSON","prototype","_len2","properties","_key2","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","value","err","live","_this2","_view","sneak","setAttribute","static","create","_Mavo$Unit","is","collection","Collection","Unit","hasAttribute","id","classList","Bliss"],"mappings":"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","file":"mavo.min.js","sourcesContent":["(function($, $$) {\n\nvar _ = Mavo.Node = $.Class({\n\tabstract: true,\n\tconstructor: function (element, mavo, o = {}) {\n\t\tif (!element || !mavo) {\n\t\t\tthrow new Error(\"Mavo.Node constructor requires an element argument and a mavo object\");\n\t\t}\n\n\t\tthis.uid = ++_.maxId;\n\n\t\tthis.element = element;\n\t\tthis.template = o.template;\n\n\t\tif (this.template) {\n\t\t\t// TODO remove if this is deleted\n\t\t\tthis.template.copies.push(this);\n\t\t}\n\t\telse {\n\t\t\tthis.copies = [];\n\t\t}\n\n\t\tthis.mavo = mavo;\n\n\t\tif (!this.fromTemplate(\"property\", \"type\", \"views\")) {\n\t\t\tthis.property = _.getProperty(element);\n\t\t\tthis.type = Mavo.Group.normalize(element);\n\t\t\tthis.store = this.element.getAttribute(\"data-store\");\n\t\t\tthis.views = this.element.getAttribute(\"data-view\");\n\t\t}\n\n\t\tthis.viewObserver = new Mavo.Observer(this.element, \"data-view\", records => {\n\t\t\tconsole.log(\"%cmutation observer on\", \"color:purple;\", this.property, this.uid, records, records[0].target == this.element);\n\t\t\tthis.view = this.element.getAttribute(\"data-view\");\n\t\t\tthis[this.view == \"edit\"? \"edit\" : \"done\"]();\n\t\t});\n\n\t\tthis.view = this.views || \"read\";\n\n\t\tthis.group = this.parentGroup = o.group;\n\n\t\tMavo.hooks.run(\"node-init-end\", this);\n\t},\n\n\tget editing() {\n\t\treturn this.view == \"edit\";\n\t},\n\n\tget constant() {\n\t\t// Is a \"constant\" if only allowed view is read\n\t\treturn this.views == \"read\";\n\t},\n\n\tget isRoot() {\n\t\treturn !this.property;\n\t},\n\n\tget name() {\n\t\treturn Mavo.readable(this.property || this.type).toLowerCase();\n\t},\n\n\tget data() {\n\t\treturn this.getData();\n\t},\n\n\tget saved() {\n\t\treturn this.store !== \"none\";\n\t},\n\n\twalk: function(callback) {\n\t\tvar walker = obj => {\n\t\t\tvar ret = callback(obj);\n\n\t\t\tif (ret !== false) {\n\t\t\t\tobj.propagate && obj.propagate(walker);\n\t\t\t}\n\t\t};\n\n\t\twalker(this);\n\t},\n\n\twalkUp: function(callback) {\n\t\tvar group = this;\n\n\t\twhile (group = group.parentGroup) {\n\t\t\tvar ret = callback(group);\n\n\t\t\tif (ret !== undefined) {\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t},\n\n\tcall: function(callback, ...args) {\n\t\targs = args || [];\n\n\t\tif (typeof callback === \"string\") {\n\t\t\treturn this[callback](...args);\n\t\t}\n\t\telse {\n\t\t\treturn callback.apply(this, [this, ...args]);\n\t\t}\n\t},\n\n\tedit: function() {\n\t\tthis.view = \"edit\";\n\t\t//if (this.uid == 32) {\n\t\t\t//console.log(\"%cedit\", \"color:red; font-weight: bold;\", this.property, this.uid);\n\t\t\t//console.trace()\n\t\t//}\n\n\t\tthis.propagate(\"edit\");\n\t},\n\n\tdone: function() {\n\t\tthis.view = \"read\";\n\t\t$.unbind(this.element, \".mavo:edit\");\n\n\t\tthis.propagate(\"done\");\n\t},\n\n\tpropagate: function() {\n\t\tfor (let i in this.children) {\n\t\t\tlet node = this.children[i];\n\n\t\t\tif (node instanceof Mavo.Node) {\n\t\t\t\tnode.call(...arguments);\n\t\t\t}\n\t\t}\n\t},\n\n\tpropagated: [\"save\", \"revert\"],\n\n\ttoJSON: Mavo.prototype.toJSON,\n\n\tfromTemplate: function(...properties) {\n\t\tif (this.template) {\n\t\t\tfor (let property of properties) {\n\t\t\t\tthis[property] = this.template[property];\n\t\t\t}\n\t\t}\n\n\t\treturn !!this.template;\n\t},\n\n\tlive: {\n\t\tview: function (value) {\n\t\t\tif (this._view != value) {\n\t\t\t\t//console.log(\"%cview on\", \"color:green;\", this.property, this.uid, \"from\", this._view, \"to\", value);\n\t\t\t\t// If we don't do this, calling edit or done below will\n\t\t\t\t// result in infinite recursion\n\t\t\t\tthis._view = value;\n\n\t\t\t\tthis.viewObserver.sneak(() => this.element.setAttribute(\"data-view\", value));\n\t\t\t}\n\t\t},\n\t},\n\n\tstatic: {\n\t\tmaxId: 0,\n\n\t\tcreate: function(element, mavo, o = {}) {\n\t\t\tif (Mavo.is(\"multiple\", element) && !o.collection) {\n\t\t\t\treturn new Mavo.Collection(element, mavo, o);\n\t\t\t}\n\n\t\t\treturn Mavo.Unit.create(...arguments);\n\t\t},\n\n\t\t/**\n\t\t * Get & normalize property name, if exists\n\t\t */\n\t\tgetProperty: function(element) {\n\t\t\tvar property = element.getAttribute(\"property\") || element.getAttribute(\"itemprop\");\n\n\t\t\tif (!property && element.hasAttribute(\"property\")) {\n\t\t\t\tproperty = element.name || element.id || element.classList[0];\n\t\t\t}\n\n\t\t\tif (property) {\n\t\t\t\telement.setAttribute(\"property\", property);\n\t\t\t}\n\n\t\t\treturn property;\n\t\t}\n\t}\n});\n\n})(Bliss, Bliss.$);\n"],"sourceRoot":"/source/"}