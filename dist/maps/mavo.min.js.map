{"version":3,"sources":["util.js"],"names":["$","$$","updateWithin","cl","element","forEach","el","classList","remove","add","parentNode","_","extend","Mavo","toJSON","data","JSON","stringify","readable","identifier","replace","$0","$1","$2","toLowerCase","toUpperCase","queryJSON","path","value","apply","concat","split","toArray","arr","undefined","Array","isArray","delete","index","indexOf","splice","flatten","reduce","prev","c","is","thing","_len","arguments","length","elements","_key","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","Symbol","iterator","next","done","matches","selectors","err","name","mavo","pushUnique","item","push","getAttribute","_len2","attributes","_key2","attribute","i","urlParam","searchParams","URL","prototype","location","_len3","names","_key3","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","get","match","search","RegExp","debounce","fn","delay","timer","context","this","args","clearTimeout","setTimeout","escapeRegExp","s","Observer","Class","constructor","callback","oldValue","MutationObserver","observer","options","attributeFilter","attributeOldValue","characterData","childList","subtree","characterDataOldValue","run","stop","running","disconnect","observe","sneak","_this","ret","requestAnimationFrame","defer","res","rej","promise","Promise","resolve","reject","a","rr","f","test","setAttribute","removeAttribute","proxy","classProps","overload","obj","property","Object","defineProperty","set","configurable","enumerable","propagated","proto","existing","propagate","document","addEventListener","evt","target","hash","documentElement","activeElement","body","Bliss"],"mappings":"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","file":"mavo.min.js","sourcesContent":["(function ($, $$) {\n\nvar _ = $.extend(Mavo, {\n\ttoJSON: data => {\n\t\tif (data === null) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\tif (typeof data === \"string\") {\n\t\t\t// Do not stringify twice!\n\t\t\treturn data;\n\t\t}\n\n\t\treturn JSON.stringify(data, null, \"\\t\");\n\t},\n\n\t// Convert an identifier to readable text that can be used as a label\n\treadable: function (identifier) {\n\t\t// Is it camelCase?\n\t\treturn identifier && identifier\n\t\t\t\t .replace(/([a-z])([A-Z])(?=[a-z])/g, ($0, $1, $2) => $1 + \" \" + $2.toLowerCase()) // camelCase?\n\t\t\t\t .replace(/([a-z])[_\\/-](?=[a-z])/g, \"$1 \") // Hyphen-separated / Underscore_separated?\n\t\t\t\t .replace(/^[a-z]/, $0 => $0.toUpperCase()); // Capitalize\n\t},\n\n\tqueryJSON: function(data, path) {\n\t\tif (!path || !data) {\n\t\t\treturn data;\n\t\t}\n\n\t\treturn $.value.apply($, [data].concat(path.split(\"/\")));\n\t},\n\n\t// If the passed value is not an array, convert to an array\n\ttoArray: arr => {\n\t\treturn arr === undefined? [] : Array.isArray(arr)? arr : [arr];\n\t},\n\n\tdelete: (arr, element) => {\n\t\tvar index = arr && arr.indexOf(element);\n\n\t\tif (index > -1) {\n\t\t\tarr.splice(index, 1);\n\t\t}\n\t},\n\n\t// Recursively flatten a multi-dimensional array\n\tflatten: arr => {\n\t\tif (!Array.isArray(arr)) {\n\t\t\treturn [arr];\n\t\t}\n\n\t\treturn arr.reduce((prev, c) => _.toArray(prev).concat(_.flatten(c)), []);\n\t},\n\n\tis: function(thing, ...elements) {\n\t\tfor (let element of elements) {\n\t\t\tif (element && element.matches && element.matches(_.selectors[thing])) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t},\n\n\tdata: (element, name, value) => {\n\t\tif (value === undefined) {\n\t\t\treturn $.value(element, \"_\", \"data\", \"mavo\", name);\n\t\t}\n\t\telse {\n\t\t\telement._.data.mavo = element._.mavo || {};\n\t\t\telement._.data.mavo[name] = value;\n\t\t}\n\t},\n\n\tpushUnique: (arr, item) => {\n\t\tif (arr.indexOf(item) === -1) {\n\t\t\tarr.push(item);\n\t\t}\n\t},\n\n\t/**\n\t * Get the value of an attribute, with fallback attributes in priority order.\n\t */\n\tgetAttribute: function(element, ...attributes) {\n\t\tfor (let i=0, attribute; attribute = attributes[i]; i++) {\n\t\t\tlet value = element.getAttribute(attribute);\n\n\t\t\tif (value) {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t},\n\n\turlParam: function(...names) {\n\t\tvar searchParams = \"searchParams\" in URL.prototype? new URL(location).searchParams : null;\n\t\tvar value = null;\n\n\t\tfor (let name of names) {\n\t\t\tif (searchParams) {\n\t\t\t\tvalue = searchParams.get(name);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar match = location.search.match(RegExp(`[?&]${name}(?:=([^&]+))?(?=&|$)`, \"i\"));\n\t\t\t\tvalue = match && (match[1] || \"\");\n\t\t\t}\n\n\t\t\tif (value !== null) {\n\t\t\t\treturn value;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t},\n\n\t// Credit: https://remysharp.com/2010/07/21/throttling-function-calls\n\tdebounce: function (fn, delay) {\n\t\tvar timer = null;\n\n\t\treturn function () {\n\t\t\tvar context = this, args = arguments;\n\n\t\t\tclearTimeout(timer);\n\t\t\ttimer = setTimeout(function () {\n\t\t\t\tfn.apply(context, args);\n\t\t\t}, delay);\n\t\t};\n\t},\n\n\tescapeRegExp: s => s.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, \"\\\\$&\"),\n\n\tObserver: $.Class({\n\t\tconstructor: function(element, attribute, callback, oldValue) {\n\t\t\tif (callback instanceof MutationObserver) {\n\t\t\t\tthis.observer = callback;\n\t\t\t}\n\n\t\t\tthis.observer = this.observer || new MutationObserver(callback);\n\t\t\tthis.element = element;\n\t\t\tthis.callback = callback;\n\t\t\tthis.attribute = attribute;\n\t\t\tthis.oldValue = oldValue;\n\n\t\t\tthis.options = {};\n\n\t\t\tif (attribute) {\n\t\t\t\t$.extend(this.options, {\n\t\t\t\t\tattributes: true,\n\t\t\t\t\tattributeFilter: this.attribute == \"all\"? undefined : [this.attribute],\n\t\t\t\t\tattributeOldValue: !!this.oldValue\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!this.attribute || this.attribute == \"all\") {\n\t\t\t\t$.extend(this.options, {\n\t\t\t\t\tcharacterData: true,\n\t\t\t\t\tchildList: true,\n\t\t\t\t\tsubtree: true,\n\t\t\t\t\tcharacterDataOldValue: !!this.oldValue\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.run();\n\t\t},\n\n\t\tstop: function() {\n\t\t\tif (this.running) {\n\t\t\t\tthis.observer.disconnect();\n\t\t\t\tthis.running = false;\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\trun: function() {\n\t\t\tif (!this.running) {\n\t\t\t\tthis.observer.observe(this.element, this.options);\n\t\t\t\tthis.running = true;\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Disconnect an observer, run some code, then observe again\n\t\t */\n\t\tsneak: function(callback) {\n\t\t\tif (this.running) {\n\t\t\t\tthis.stop();\n\t\t\t\tvar ret = callback();\n\t\t\t\trequestAnimationFrame(() => this.run());\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar ret = callback();\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t}\n\t}),\n\n\tdefer: function(constructor) {\n\t\tvar res, rej;\n\n\t\tvar promise = new Promise((resolve, reject) => {\n\t\t\tif (constructor) {\n\t\t\t\tconstructor(resolve, reject);\n\t\t\t}\n\n\t\t\tres = resolve;\n\t\t\trej = reject;\n\t\t});\n\n\t\tpromise.resolve = a => {\n\t\t\tres(a);\n\t\t\treturn promise;\n\t\t};\n\n\t\tpromise.reject = a => {\n\t\t\trej(a);\n\t\t\treturn promise;\n\t\t};\n\n\t\treturn promise;\n\t},\n\n\t/**\n\t * Run & Return a function\n\t */\n\trr: function(f) {\n\t\tf();\n\t\treturn f;\n\t}\n});\n\n// Bliss plugins\n\n$.add(\"toggleAttribute\", function(name, value, test = value !== null) {\n\tif (test) {\n\t\tthis.setAttribute(name, value);\n\t}\n\telse {\n\t\tthis.removeAttribute(name);\n\t}\n});\n\n// Provide shortcuts to long property chains\n$.proxy = $.classProps.proxy = $.overload(function(obj, property, proxy) {\n\tObject.defineProperty(obj, property, {\n\t\tget: function() {\n\t\t\treturn this[proxy][property];\n\t\t},\n\t\tset: function(value) {\n\t\t\tthis[proxy][property] = value;\n\t\t},\n\t\tconfigurable: true,\n\t\tenumerable: true\n\t});\n\n\treturn obj;\n});\n\n$.classProps.propagated = function(proto, names) {\n\tMavo.toArray(names).forEach(name => {\n\t\tvar existing = proto[name];\n\n\t\tproto[name] = function() {\n\t\t\tvar ret = existing && existing.apply(this, arguments);\n\n\t\t\tif (this.propagate && ret !== false) {\n\t\t\t\tthis.propagate(name);\n\t\t\t}\n\t\t};\n\t});\n};\n\n// :focus-within and :target-within shim\nfunction updateWithin(cl, element) {\n\tcl = \"mv-\" + cl + \"-within\";\n\t$$(\".\" + cl).forEach(el => el.classList.remove(cl));\n\n\twhile (element && element.classList) {\n\t\telement.classList.add(cl);\n\t\telement = element.parentNode;\n\t}\n};\n\ndocument.addEventListener(\"focus\", evt => {\n\tupdateWithin(\"focus\", evt.target);\n}, true);\n\ndocument.addEventListener(\"blur\", evt => {\n\tupdateWithin(\"focus\", null);\n}, true);\n\naddEventListener(\"hashchange\", evt => {\n\tupdateWithin(\"target\", $(location.hash));\n});\n\ndocument.documentElement.addEventListener(\"mavo:datachange\", evt => {\n\t// TODO debounce\n\tupdateWithin(\"target\", $(location.hash));\n});\n\nupdateWithin(\"focus\", document.activeElement !== document.body? document.activeElement : null);\n\n})(Bliss, Bliss.$);\n"],"sourceRoot":"/source/"}