{"version":3,"sources":["node.js"],"names":[],"mappings":"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","file":"mavo.es5.js","sourcesContent":["(function($, $$) {\n\nvar _ = Mavo.Node = $.Class({\n\tabstract: true,\n\tconstructor: function (element, mavo, o = {}) {\n\t\tif (!element || !mavo) {\n\t\t\tthrow new Error(\"Mavo.Node constructor requires an element argument and a mavo object\");\n\t\t}\n\n\t\tthis.uid = ++_.maxId;\n\n\t\tthis.element = element;\n\t\tthis.template = o.template;\n\n\t\tif (this.template) {\n\t\t\t// TODO remove if this is deleted\n\t\t\tthis.template.copies.push(this);\n\t\t}\n\t\telse {\n\t\t\tthis.copies = [];\n\t\t}\n\n\t\tthis.mavo = mavo;\n\n\t\tif (!this.fromTemplate(\"property\", \"type\", \"views\")) {\n\t\t\tthis.property = _.getProperty(element);\n\t\t\tthis.type = Mavo.Group.normalize(element);\n\t\t\tthis.store = this.element.getAttribute(\"data-store\");\n\t\t\tthis.views = this.element.getAttribute(\"data-view\");\n\t\t}\n\n\t\tthis.viewObserver = new Mavo.Observer(this.element, \"data-view\", records => {\n\t\t\tconsole.log(\"%cmutation observer on\", \"color:purple;\", this.property, this.uid, records, records[0].target == this.element);\n\t\t\tthis.view = this.element.getAttribute(\"data-view\");\n\t\t\tthis[this.view == \"edit\"? \"edit\" : \"done\"]();\n\t\t});\n\n\t\tthis.view = this.views || \"read\";\n\n\t\tthis.group = this.parentGroup = o.group;\n\n\t\tMavo.hooks.run(\"node-init-end\", this);\n\t},\n\n\tget editing() {\n\t\treturn this.view == \"edit\";\n\t},\n\n\tget constant() {\n\t\t// Is a \"constant\" if only allowed view is read\n\t\treturn this.views == \"read\";\n\t},\n\n\tget isRoot() {\n\t\treturn !this.property;\n\t},\n\n\tget name() {\n\t\treturn Mavo.readable(this.property || this.type).toLowerCase();\n\t},\n\n\tget data() {\n\t\treturn this.getData();\n\t},\n\n\tget saved() {\n\t\treturn this.store !== \"none\";\n\t},\n\n\twalk: function(callback) {\n\t\tvar walker = obj => {\n\t\t\tvar ret = callback(obj);\n\n\t\t\tif (ret !== false) {\n\t\t\t\tobj.propagate && obj.propagate(walker);\n\t\t\t}\n\t\t};\n\n\t\twalker(this);\n\t},\n\n\twalkUp: function(callback) {\n\t\tvar group = this;\n\n\t\twhile (group = group.parentGroup) {\n\t\t\tvar ret = callback(group);\n\n\t\t\tif (ret !== undefined) {\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t},\n\n\tcall: function(callback, ...args) {\n\t\targs = args || [];\n\n\t\tif (typeof callback === \"string\") {\n\t\t\treturn this[callback](...args);\n\t\t}\n\t\telse {\n\t\t\treturn callback.apply(this, [this, ...args]);\n\t\t}\n\t},\n\n\tedit: function() {\n\t\tthis.view = \"edit\";\n\t\t//if (this.uid == 32) {\n\t\t\t//console.log(\"%cedit\", \"color:red; font-weight: bold;\", this.property, this.uid);\n\t\t\t//console.trace()\n\t\t//}\n\n\t\tthis.propagate(\"edit\");\n\t},\n\n\tdone: function() {\n\t\tthis.view = \"read\";\n\t\t$.unbind(this.element, \".mavo:edit\");\n\n\t\tthis.propagate(\"done\");\n\t},\n\n\tpropagate: function() {\n\t\tfor (let i in this.children) {\n\t\t\tlet node = this.children[i];\n\n\t\t\tif (node instanceof Mavo.Node) {\n\t\t\t\tnode.call(...arguments);\n\t\t\t}\n\t\t}\n\t},\n\n\tpropagated: [\"save\", \"revert\"],\n\n\ttoJSON: Mavo.prototype.toJSON,\n\n\tfromTemplate: function(...properties) {\n\t\tif (this.template) {\n\t\t\tfor (let property of properties) {\n\t\t\t\tthis[property] = this.template[property];\n\t\t\t}\n\t\t}\n\n\t\treturn !!this.template;\n\t},\n\n\tlive: {\n\t\tview: function (value) {\n\t\t\tif (this._view != value) {\n\t\t\t\t//console.log(\"%cview on\", \"color:green;\", this.property, this.uid, \"from\", this._view, \"to\", value);\n\t\t\t\t// If we don't do this, calling edit or done below will\n\t\t\t\t// result in infinite recursion\n\t\t\t\tthis._view = value;\n\n\t\t\t\tthis.viewObserver.sneak(() => this.element.setAttribute(\"data-view\", value));\n\t\t\t}\n\t\t},\n\t},\n\n\tstatic: {\n\t\tmaxId: 0,\n\n\t\tcreate: function(element, mavo, o = {}) {\n\t\t\tif (Mavo.is(\"multiple\", element) && !o.collection) {\n\t\t\t\treturn new Mavo.Collection(element, mavo, o);\n\t\t\t}\n\n\t\t\treturn Mavo.Unit.create(...arguments);\n\t\t},\n\n\t\t/**\n\t\t * Get & normalize property name, if exists\n\t\t */\n\t\tgetProperty: function(element) {\n\t\t\tvar property = element.getAttribute(\"property\") || element.getAttribute(\"itemprop\");\n\n\t\t\tif (!property && element.hasAttribute(\"property\")) {\n\t\t\t\tproperty = element.name || element.id || element.classList[0];\n\t\t\t}\n\n\t\t\tif (property) {\n\t\t\t\telement.setAttribute(\"property\", property);\n\t\t\t}\n\n\t\t\treturn property;\n\t\t}\n\t}\n});\n\n})(Bliss, Bliss.$);\n"],"sourceRoot":"/source/"}