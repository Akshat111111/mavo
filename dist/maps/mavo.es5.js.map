{"version":3,"sources":["node.js"],"names":[],"mappings":";;AAAA,CAAC,UAAS,CAAT,EAAY,EAAZ,EAAgB;;AAEjB,KAAI,IAAI,KAAK,IAAL,GAAY,EAAE,KAAF,CAAQ;AAC3B,YAAU,IADiB;AAE3B,eAAa,qBAAU,OAAV,EAAmB,IAAnB,EAAiC;AAAA;;AAAA,OAAR,CAAQ,yDAAJ,EAAI;;AAC7C,OAAI,CAAC,OAAD,IAAY,CAAC,IAAjB,EAAuB;AACtB,UAAM,IAAI,KAAJ,CAAU,sEAAV,CAAN;AACA;;AAED,QAAK,GAAL,GAAW,EAAE,EAAE,KAAf;;AAEA,QAAK,OAAL,GAAe,OAAf;AACA,QAAK,QAAL,GAAgB,EAAE,QAAlB;;AAEA,OAAI,KAAK,QAAT,EAAmB;AAClB;AACA,SAAK,QAAL,CAAc,MAAd,CAAqB,IAArB,CAA0B,IAA1B;AACA,IAHD,MAIK;AACJ,SAAK,MAAL,GAAc,EAAd;AACA;;AAED,QAAK,IAAL,GAAY,IAAZ;;AAEA,OAAI,CAAC,KAAK,YAAL,CAAkB,UAAlB,EAA8B,MAA9B,EAAsC,OAAtC,CAAL,EAAqD;AACpD,SAAK,QAAL,GAAgB,EAAE,WAAF,CAAc,OAAd,CAAhB;AACA,SAAK,IAAL,GAAY,KAAK,KAAL,CAAW,SAAX,CAAqB,OAArB,CAAZ;AACA,SAAK,KAAL,GAAa,KAAK,OAAL,CAAa,YAAb,CAA0B,YAA1B,CAAb;AACA,SAAK,KAAL,GAAa,KAAK,OAAL,CAAa,YAAb,CAA0B,WAA1B,CAAb;AACA;;AAED,QAAK,YAAL,GAAoB,IAAI,KAAK,QAAT,CAAkB,KAAK,OAAvB,EAAgC,WAAhC,EAA6C,mBAAW;AAC3E,YAAQ,GAAR,CAAY,wBAAZ,EAAsC,eAAtC,EAAuD,MAAK,QAA5D,EAAsE,MAAK,GAA3E,EAAgF,MAAK,QAArF;AACA,UAAK,IAAL,GAAY,MAAK,OAAL,CAAa,YAAb,CAA0B,WAA1B,CAAZ;AACA,UAAK,MAAK,IAAL,IAAa,MAAb,GAAqB,MAArB,GAA8B,MAAnC;AACA,IAJmB,CAApB;;AAMA,QAAK,IAAL,GAAY,KAAK,KAAL,IAAc,MAA1B;;AAEA,QAAK,KAAL,GAAa,KAAK,WAAL,GAAmB,EAAE,KAAlC;;AAEA,QAAK,KAAL,CAAW,GAAX,CAAe,eAAf,EAAgC,IAAhC;AACA,GAxC0B;;AA0C3B,MAAI,OAAJ,GAAc;AACb,UAAO,KAAK,IAAL,IAAa,MAApB;AACA,GA5C0B;;AA8C3B,MAAI,QAAJ,GAAe;AACd;AACA,UAAO,KAAK,KAAL,IAAc,MAArB;AACA,GAjD0B;;AAmD3B,MAAI,MAAJ,GAAa;AACZ,UAAO,CAAC,KAAK,QAAb;AACA,GArD0B;;AAuD3B,MAAI,IAAJ,GAAW;AACV,UAAO,KAAK,QAAL,CAAc,KAAK,QAAL,IAAiB,KAAK,IAApC,EAA0C,WAA1C,EAAP;AACA,GAzD0B;;AA2D3B,MAAI,IAAJ,GAAW;AACV,UAAO,KAAK,OAAL,EAAP;AACA,GA7D0B;;AA+D3B,MAAI,KAAJ,GAAY;AACX,UAAO,KAAK,KAAL,KAAe,MAAtB;AACA,GAjE0B;;AAmE3B,QAAM,cAAS,QAAT,EAAmB;AACxB,OAAI,SAAS,SAAT,MAAS,MAAO;AACnB,QAAI,MAAM,SAAS,GAAT,CAAV;;AAEA,QAAI,QAAQ,KAAZ,EAAmB;AAClB,SAAI,SAAJ,IAAiB,IAAI,SAAJ,CAAc,MAAd,CAAjB;AACA;AACD,IAND;;AAQA,UAAO,IAAP;AACA,GA7E0B;;AA+E3B,UAAQ,gBAAS,QAAT,EAAmB;AAC1B,OAAI,QAAQ,IAAZ;;AAEA,UAAO,QAAQ,MAAM,WAArB,EAAkC;AACjC,QAAI,MAAM,SAAS,KAAT,CAAV;;AAEA,QAAI,QAAQ,SAAZ,EAAuB;AACtB,YAAO,GAAP;AACA;AACD;AACD,GAzF0B;;AA2F3B,QAAM,gBAAW;AAChB,QAAK,IAAL,GAAY,MAAZ;;AAEA,QAAK,SAAL,CAAe,MAAf;;AAEA,QAAK,KAAL,CAAW,GAAX,CAAe,eAAf,EAAgC,IAAhC;AACA,GAjG0B;;AAmG3B,QAAM,gBAAW;AAChB,QAAK,IAAL,GAAY,MAAZ;AACA,KAAE,MAAF,CAAS,KAAK,OAAd,EAAuB,YAAvB;;AAEA,QAAK,SAAL,CAAe,MAAf;;AAEA,QAAK,KAAL,CAAW,GAAX,CAAe,eAAf,EAAgC,IAAhC;AACA,GA1G0B;;AA4G3B,aAAW,mBAAS,QAAT,EAAmB;AAC7B,QAAK,IAAI,CAAT,IAAc,KAAK,QAAnB,EAA6B;AAC5B,QAAI,OAAO,KAAK,QAAL,CAAc,CAAd,CAAX;;AAEA,QAAI,gBAAgB,KAAK,IAAzB,EAA+B;AAC9B,SAAI,OAAO,QAAP,KAAoB,UAAxB,EAAoC;AACnC,eAAS,IAAT,CAAc,IAAd,EAAoB,IAApB;AACA,MAFD,MAGK,IAAI,YAAY,IAAhB,EAAsB;AAC1B,WAAK,QAAL;AACA;AACD;AACD;AACD,GAzH0B;;AA2H3B,cAAY,CAAC,MAAD,EAAS,QAAT,CA3He;;AA6H3B,UAAQ,KAAK,SAAL,CAAe,MA7HI;;AA+H3B,gBAAc,wBAAwB;AACrC,OAAI,KAAK,QAAT,EAAmB;AAAA,sCADM,UACN;AADM,eACN;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAClB,0BAAqB,UAArB,8HAAiC;AAAA,UAAxB,QAAwB;;AAChC,WAAK,QAAL,IAAiB,KAAK,QAAL,CAAc,QAAd,CAAjB;AACA;AAHiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIlB;;AAED,UAAO,CAAC,CAAC,KAAK,QAAd;AACA,GAvI0B;;AAyI3B,QAAM;AACL,SAAM,cAAU,KAAV,EAAiB;AAAA;;AACtB,QAAI,KAAK,KAAL,IAAc,KAAlB,EAAyB;AACxB;AACA;AACA,UAAK,KAAL,GAAa,KAAb;;AAEA,UAAK,YAAL,CAAkB,KAAlB,CAAwB,YAAM;AAC7B,UAAI,MAAM,OAAK,KAAL,IAAc,OAAK,IAAL,IAAa,MAArC;AACA,QAAE,eAAF,CAAkB,OAAK,OAAvB,EAAgC,WAAhC,EAA6C,KAA7C,EAAoD,GAApD;AACA,MAHD;AAIA;AACD;AAZI,GAzIqB;;AAwJ3B,UAAQ;AACP,UAAO,CADA;;AAGP,WAAQ,gBAAS,OAAT,EAAkB,IAAlB,EAAgC;AAAA;;AAAA,QAAR,CAAQ,yDAAJ,EAAI;;AACvC,QAAI,KAAK,EAAL,CAAQ,UAAR,EAAoB,OAApB,KAAgC,CAAC,EAAE,UAAvC,EAAmD;AAClD,YAAO,IAAI,KAAK,UAAT,CAAoB,OAApB,EAA6B,IAA7B,EAAmC,CAAnC,CAAP;AACA;;AAED,WAAO,mBAAK,IAAL,EAAU,MAAV,mBAAoB,SAApB,CAAP;AACA,IATM;;AAWP;;;AAGA,gBAAa,qBAAS,OAAT,EAAkB;AAC9B,QAAI,WAAW,QAAQ,YAAR,CAAqB,UAArB,KAAoC,QAAQ,YAAR,CAAqB,UAArB,CAAnD;;AAEA,QAAI,CAAC,QAAD,IAAa,QAAQ,YAAR,CAAqB,UAArB,CAAjB,EAAmD;AAClD,gBAAW,QAAQ,IAAR,IAAgB,QAAQ,EAAxB,IAA8B,QAAQ,SAAR,CAAkB,CAAlB,CAAzC;AACA;;AAED,QAAI,QAAJ,EAAc;AACb,aAAQ,YAAR,CAAqB,UAArB,EAAiC,QAAjC;AACA;;AAED,WAAO,QAAP;AACA;AA1BM;AAxJmB,EAAR,CAApB;AAsLC,CAxLD,EAwLG,KAxLH,EAwLU,MAAM,CAxLhB","file":"mavo.es5.js","sourcesContent":["(function($, $$) {\n\nvar _ = Mavo.Node = $.Class({\n\tabstract: true,\n\tconstructor: function (element, mavo, o = {}) {\n\t\tif (!element || !mavo) {\n\t\t\tthrow new Error(\"Mavo.Node constructor requires an element argument and a mavo object\");\n\t\t}\n\n\t\tthis.uid = ++_.maxId;\n\n\t\tthis.element = element;\n\t\tthis.template = o.template;\n\n\t\tif (this.template) {\n\t\t\t// TODO remove if this is deleted\n\t\t\tthis.template.copies.push(this);\n\t\t}\n\t\telse {\n\t\t\tthis.copies = [];\n\t\t}\n\n\t\tthis.mavo = mavo;\n\n\t\tif (!this.fromTemplate(\"property\", \"type\", \"modes\")) {\n\t\t\tthis.property = _.getProperty(element);\n\t\t\tthis.type = Mavo.Group.normalize(element);\n\t\t\tthis.store = this.element.getAttribute(\"data-store\");\n\t\t\tthis.modes = this.element.getAttribute(\"data-mode\");\n\t\t}\n\n\t\tthis.modeObserver = new Mavo.Observer(this.element, \"data-mode\", records => {\n\t\t\tconsole.log(\"%cmutation observer on\", \"color:purple;\", this.property, this.uid, this.template);\n\t\t\tthis.mode = this.element.getAttribute(\"data-mode\");\n\t\t\tthis[this.mode == \"edit\"? \"edit\" : \"done\"]();\n\t\t});\n\n\t\tthis.mode = this.modes || \"read\";\n\n\t\tthis.group = this.parentGroup = o.group;\n\n\t\tMavo.hooks.run(\"node-init-end\", this);\n\t},\n\n\tget editing() {\n\t\treturn this.mode == \"edit\";\n\t},\n\n\tget constant() {\n\t\t// Is a \"constant\" if only allowed mode is read\n\t\treturn this.modes == \"read\";\n\t},\n\n\tget isRoot() {\n\t\treturn !this.property;\n\t},\n\n\tget name() {\n\t\treturn Mavo.readable(this.property || this.type).toLowerCase();\n\t},\n\n\tget data() {\n\t\treturn this.getData();\n\t},\n\n\tget saved() {\n\t\treturn this.store !== \"none\";\n\t},\n\n\twalk: function(callback) {\n\t\tvar walker = obj => {\n\t\t\tvar ret = callback(obj);\n\n\t\t\tif (ret !== false) {\n\t\t\t\tobj.propagate && obj.propagate(walker);\n\t\t\t}\n\t\t};\n\n\t\twalker(this);\n\t},\n\n\twalkUp: function(callback) {\n\t\tvar group = this;\n\n\t\twhile (group = group.parentGroup) {\n\t\t\tvar ret = callback(group);\n\n\t\t\tif (ret !== undefined) {\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t},\n\n\tedit: function() {\n\t\tthis.mode = \"edit\";\n\n\t\tthis.propagate(\"edit\");\n\n\t\tMavo.hooks.run(\"node-edit-end\", this);\n\t},\n\n\tdone: function() {\n\t\tthis.mode = \"read\";\n\t\t$.unbind(this.element, \".mavo:edit\");\n\n\t\tthis.propagate(\"done\");\n\n\t\tMavo.hooks.run(\"node-done-end\", this);\n\t},\n\n\tpropagate: function(callback) {\n\t\tfor (let i in this.children) {\n\t\t\tlet node = this.children[i];\n\n\t\t\tif (node instanceof Mavo.Node) {\n\t\t\t\tif (typeof callback === \"function\") {\n\t\t\t\t\tcallback.call(node, node);\n\t\t\t\t}\n\t\t\t\telse if (callback in node) {\n\t\t\t\t\tnode[callback]();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tpropagated: [\"save\", \"revert\"],\n\n\ttoJSON: Mavo.prototype.toJSON,\n\n\tfromTemplate: function(...properties) {\n\t\tif (this.template) {\n\t\t\tfor (let property of properties) {\n\t\t\t\tthis[property] = this.template[property];\n\t\t\t}\n\t\t}\n\n\t\treturn !!this.template;\n\t},\n\n\tlive: {\n\t\tmode: function (value) {\n\t\t\tif (this._mode != value) {\n\t\t\t\t// If we don't do this, calling setAttribute below will\n\t\t\t\t// result in infinite recursion\n\t\t\t\tthis._mode = value;\n\n\t\t\t\tthis.modeObserver.sneak(() => {\n\t\t\t\t\tvar set = this.modes || this.mode == \"edit\";\n\t\t\t\t\t$.toggleAttribute(this.element, \"data-mode\", value, set);\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t},\n\n\tstatic: {\n\t\tmaxId: 0,\n\n\t\tcreate: function(element, mavo, o = {}) {\n\t\t\tif (Mavo.is(\"multiple\", element) && !o.collection) {\n\t\t\t\treturn new Mavo.Collection(element, mavo, o);\n\t\t\t}\n\n\t\t\treturn Mavo.Unit.create(...arguments);\n\t\t},\n\n\t\t/**\n\t\t * Get & normalize property name, if exists\n\t\t */\n\t\tgetProperty: function(element) {\n\t\t\tvar property = element.getAttribute(\"property\") || element.getAttribute(\"itemprop\");\n\n\t\t\tif (!property && element.hasAttribute(\"property\")) {\n\t\t\t\tproperty = element.name || element.id || element.classList[0];\n\t\t\t}\n\n\t\t\tif (property) {\n\t\t\t\telement.setAttribute(\"property\", property);\n\t\t\t}\n\n\t\t\treturn property;\n\t\t}\n\t}\n});\n\n})(Bliss, Bliss.$);\n"],"sourceRoot":"/source/"}