{"version":3,"sources":["mavo.js"],"names":[],"mappings":"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","file":"mavo.es5.js","sourcesContent":["(function ($, $$) {\n\n\"use strict\";\n\nvar _ = self.Mavo = $.Class({\n\tconstructor: function (element) {\n\t\tthis.treeBuilt = Mavo.defer();\n\n\t\tthis.element = element;\n\n\t\t// Convert any data-mv-* attributes to mv-*\n\t\tvar dataMv = _.attributes.map(attribute => `[data-${attribute}]`);\n\t\tfor (let element of $$(dataMv.join(\", \"), this.element).concat(this.element)) {\n\t\t\tfor (let attribute of _.attributes) {\n\t\t\t\tlet value = element.getAttribute(\"data-\" + attribute);\n\n\t\t\t\tif (value !== null) {\n\t\t\t\t\telement.setAttribute(attribute, value);\n\t\t\t\t}\n\n\t\t\t}\n\t\t}\n\n\t\t// Index among other mavos in the page, 1 is first\n\t\tthis.index = _.all.push(this);\n\n\t\t// Assign a unique (for the page) id to this mavo instance\n\t\tthis.id = Mavo.getAttribute(this.element, \"mv-app\", \"id\") || `mavo${this.index}`;\n\t\tthis.element.setAttribute(\"mv-app\", this.id);\n\n\t\tthis.unhandled = this.element.classList.contains(\"mv-keep-unhandled\");\n\t\tthis.autoEdit = this.element.classList.contains(\"mv-autoedit\");\n\n\t\tif (this.index == 1) {\n\t\t\tthis.storage = _.urlParam(\"store\");\n\t\t\tthis.source = _.urlParam(\"source\");\n\t\t}\n\n\t\tthis.storage = this.storage || _.urlParam(`${this.id}_store`) || this.element.getAttribute(\"mv-storage\") || null;\n\t\tthis.source = this.source || _.urlParam(`${this.id}_source`) || this.element.getAttribute(\"mv-init\") || null;\n\n\t\tif (this.storage) {\n\t\t\tthis.storage = this.storage.trim();\n\n\t\t\tthis.storage = this.storage == \"none\"? null : _.Backend.create(this.storage, this);\n\t\t}\n\n\t\tif (this.source) {\n\t\t\tthis.source = _.Backend.create(this.source, this);\n\t\t}\n\n\t\tthis.permissions = this.storage ? this.storage.permissions : new Mavo.Permissions();\n\n\t\t// Ctrl + S or Cmd + S to save\n\t\tthis.element.addEventListener(\"keydown\", evt => {\n\t\t\tif (evt.keyCode == 83 && evt[_.superKey]) {\n\t\t\t\tevt.preventDefault();\n\t\t\t\tthis.save();\n\t\t\t}\n\t\t});\n\n\t\tthis.element.setAttribute(\"typeof\", \"\");\n\n\t\t// Apply heuristic for groups\n\t\t$$(_.selectors.primitive, element).forEach(element => {\n\t\t\tvar hasChildren = $(`${_.selectors.not(_.selectors.formControl)}, ${_.selectors.property}`, element);\n\n\t\t\tif (hasChildren) {\n\t\t\t\tvar defaults = Mavo.Primitive.getDefaults(element);\n\t\t\t\tvar isCollection = Mavo.is(\"multiple\", element);\n\n\t\t\t\tif (isCollection || !Mavo.Primitive.getValueAttribute(element, defaults) && !defaults.hasChildren) {\n\t\t\t\t\telement.setAttribute(\"typeof\", \"\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.ui = {\n\t\t\tbar: $(\".mv-bar\", this.element) || $.create({\n\t\t\t\tclassName: \"mv-bar mv-ui\",\n\t\t\t\tstart: this.element\n\t\t\t})\n\t\t};\n\n\t\tthis.ui.status = $(\".mv-status\", this.ui.bar) || $.create(\"span\", {\n\t\t\tclassName: \"mv-status\",\n\t\t\tinside: this.ui.bar\n\t\t});\n\n\t\tif (this.storage) {\n\t\t\t// Reflect backend permissions in global permissions\n\t\t\tthis.authControls = {};\n\n\t\t\tthis.permissions.can(\"login\", () => {\n\t\t\t\t// #login authenticates if only 1 mavo on the page, or if the first.\n\t\t\t\t// Otherwise, we have to generate a slightly more complex hash\n\t\t\t\tthis.loginHash = \"#login\" + (Mavo.all[0] === this? \"\" : \"-\" + this.id);\n\n\t\t\t\tthis.authControls.login = $.create({\n\t\t\t\t\ttag: \"a\",\n\t\t\t\t\thref: this.loginHash,\n\t\t\t\t\ttextContent: \"Login\",\n\t\t\t\t\tclassName: \"mv-login mv-button\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: evt => {\n\t\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t\t\tthis.storage.login();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tafter: $(\".mv-status\", this.ui.bar)\n\t\t\t\t});\n\n\t\t\t\t// We also support a hash to trigger login, in case the user doesn't want visible login UI\n\t\t\t\tvar login;\n\t\t\t\t(login = () => {\n\t\t\t\t\tif (location.hash === this.loginHash) {\n\t\t\t\t\t\t// This just does location.hash = \"\" without getting a pointless # at the end of the URL\n\t\t\t\t\t\thistory.replaceState(null, document.title, new URL(\"\", location) + \"\");\n\t\t\t\t\t\tthis.storage.login();\n\t\t\t\t\t}\n\t\t\t\t})();\n\t\t\t\twindow.addEventListener(\"hashchange.mavo\", login);\n\t\t\t}, () => {\n\t\t\t\t$.remove(this.authControls.login);\n\t\t\t\tthis.element._.unbind(\"hashchange.mavo\");\n\t\t\t});\n\n\t\t\t// Update login status\n\t\t\tthis.element.addEventListener(\"mavo:login.mavo\", evt => {\n\t\t\t\tif (evt.backend == this.storage) { // ignore logins from source backend\n\t\t\t\t\tvar status = $(\".mv-status\", this.ui.bar);\n\t\t\t\t\tstatus.innerHTML = \"\";\n\t\t\t\t\tstatus._.contents([\n\t\t\t\t\t\t\"Logged in to \" + evt.backend.id + \" as \",\n\t\t\t\t\t\t{tag: \"strong\", innerHTML: evt.name},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\t\ttextContent: \"Logout\",\n\t\t\t\t\t\t\tclassName: \"mv-logout\",\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tclick: e => evt.backend.logout()\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.element.addEventListener(\"mavo:logout.mavo\", evt => {\n\t\t\t\t$(\".mv-status\", this.ui.bar).textContent = \"\";\n\t\t\t});\n\t\t}\n\n\t\t// Is there any control that requires an edit button?\n\t\tthis.needsEdit = false;\n\n\t\t// Build mavo objects\n\t\tMavo.hooks.run(\"init-tree-before\", this);\n\n\t\tthis.root = new Mavo.Group(this.element, this);\n\t\tthis.treeBuilt.resolve();\n\n\t\tMavo.hooks.run(\"init-tree-after\", this);\n\n\t\tthis.setUnsavedChanges(false);\n\n\t\tthis.permissions.onchange(({action, value}) => {\n\t\t\tvar permissions = this.element.getAttribute(\"mv-permissions\") || \"\";\n\t\t\tpermissions = permissions.trim().split(/\\s+/).filter(a => a != action);\n\n\t\t\tif (value) {\n\t\t\t\tpermissions.push(action);\n\t\t\t}\n\n\t\t\tthis.element.setAttribute(\"mv-permissions\", permissions.join(\" \"));\n\t\t});\n\n\t\tthis.permissions.can([\"edit\", \"add\", \"delete\"], () => {\n\t\t\tthis.ui.edit = $.create(\"button\", {\n\t\t\t\tclassName: \"mv-edit\",\n\t\t\t\ttextContent: \"Edit\",\n\t\t\t\tonclick: e => this.editing? this.done() : this.edit(),\n\t\t\t\tinside: this.ui.bar\n\t\t\t});\n\n\t\t\tif (this.autoEdit) {\n\t\t\t\tthis.ui.edit.click();\n\t\t\t}\n\t\t}, () => { // cannot\n\t\t\t$.remove(this.ui.edit);\n\n\t\t\tif (this.editing) {\n\t\t\t\tthis.done();\n\t\t\t}\n\t\t});\n\n\t\tif (this.needsEdit) {\n\t\t\tthis.permissions.can(\"save\", () => {\n\t\t\t\tthis.ui.save = $.create(\"button\", {\n\t\t\t\t\tclassName: \"mv-save\",\n\t\t\t\t\ttextContent: \"Save\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: e => this.save(),\n\t\t\t\t\t\t\"mouseenter focus\": e => {\n\t\t\t\t\t\t\tthis.element.classList.add(\"mv-save-hovered\");\n\t\t\t\t\t\t\tthis.setUnsavedChanges();\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"mouseleave blur\": e => this.element.classList.remove(\"mv-save-hovered\")\n\t\t\t\t\t},\n\t\t\t\t\tinside: this.ui.bar\n\t\t\t\t});\n\n\t\t\t\tthis.ui.revert = $.create(\"button\", {\n\t\t\t\t\tclassName: \"mv-revert\",\n\t\t\t\t\ttextContent: \"Revert\",\n\t\t\t\t\tdisabled: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: e => this.revert(),\n\t\t\t\t\t\t\"mouseenter focus\": e => {\n\t\t\t\t\t\t\tif (!this.unsavedChanges) {\n\t\t\t\t\t\t\t\tthis.element.classList.add(\"mv-revert-hovered\");\n\t\t\t\t\t\t\t\tthis.setUnsavedChanges();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"mouseleave blur\": e => this.element.classList.remove(\"mv-revert-hovered\")\n\t\t\t\t\t},\n\t\t\t\t\tinside: this.ui.bar\n\t\t\t\t});\n\t\t\t}, () => {\n\t\t\t\t$.remove([this.ui.save, this.ui.revert]);\n\t\t\t\tthis.ui.save = this.ui.revert = null;\n\t\t\t});\n\t\t}\n\n\t\tthis.permissions.can(\"delete\", () => {\n\t\t\tthis.ui.clear = $.create(\"button\", {\n\t\t\t\tclassName: \"mv-clear\",\n\t\t\t\ttextContent: \"Clear\",\n\t\t\t\tonclick: e => this.clear()\n\t\t\t});\n\n\t\t\tthis.ui.bar.appendChild(this.ui.clear);\n\t\t});\n\n\t\tthis.permissions.cannot([\"delete\", \"edit\"], () => {\n\t\t\t$.remove(this.ui.clear);\n\t\t});\n\n\t\tif (this.storage || this.source) {\n\t\t\t// Fetch existing data\n\t\t\tif (!this.storage) {\n\t\t\t\tthis.source.permissions.can(\"read\", () => this.permissions.read = true);\n\t\t\t}\n\n\t\t\tthis.permissions.can(\"read\", () => this.load());\n\t\t}\n\t\telse {\n\t\t\t// No storage\n\t\t\tthis.permissions.on([\"read\", \"edit\"]);\n\n\t\t\t$.fire(this.element, \"mavo:load\");\n\t\t}\n\n\t\tif (!this.needsEdit) {\n\t\t\tthis.permissions.off([\"edit\", \"add\", \"delete\"]);\n\n\t\t\t// If there's no edit mode, we must save immediately when properties change\n\t\t\tthis.element.addEventListener(\"mavo:load\", evt => {\n\t\t\t\tvar debouncedSave = _.debounce(() => {\n\t\t\t\t\tthis.save();\n\t\t\t\t}, 1000);\n\n\t\t\t\tvar callback = evt => {\n\t\t\t\t\tif (evt.node.saved) {\n\t\t\t\t\t\tdebouncedSave();\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\trequestAnimationFrame(() => {\n\t\t\t\t\tthis.permissions.can(\"save\", () => {\n\t\t\t\t\t\tthis.element.addEventListener(\"mavo:datachange\", callback);\n\t\t\t\t\t}, () => {\n\t\t\t\t\t\tthis.element.removeEventListener(\"mavo:datachange\", callback);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tMavo.hooks.run(\"init-end\", this);\n\t},\n\n\tget editing() {\n\t\treturn this.root.editing;\n\t},\n\n\tget data() {\n\t\treturn this.getData();\n\t},\n\n\tgetData: function(o) {\n\t\treturn this.root.getData(o);\n\t},\n\n\ttoJSON: function(data = this.data) {\n\t\treturn _.toJSON(data);\n\t},\n\n\trender: function(data) {\n\t\t_.hooks.run(\"render-start\", {context: this, data});\n\n\t\tif (data) {\n\t\t\tif (this.editing) { // TODO this logic should go to Node\n\t\t\t\tthis.done();\n\t\t\t\tthis.root.render(data);\n\t\t\t\tthis.edit();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.root.render(data);\n\t\t\t}\n\n\t\t}\n\n\t\tthis.unsavedChanges = false;\n\t},\n\n\tclear: function() {\n\t\tif (confirm(\"This will delete all your data. Are you sure?\")) {\n\t\t\tthis.store(null);\n\t\t\tthis.root.clear();\n\t\t}\n\t},\n\n\tedit: function() {\n\t\tthis.root.edit();\n\n\t\t$.events(this.element, \"mouseenter.mavo:edit mouseleave.mavo:edit\", evt => {\n\t\t\tif (evt.target.matches(\".mv-item-controls .mv-delete\")) {\n\t\t\t\tvar item = evt.target.closest(_.selectors.item);\n\t\t\t\titem.classList.toggle(\"mv-delete-hover\", evt.type == \"mouseenter\");\n\t\t\t}\n\n\t\t\tif (evt.target.matches(_.selectors.item)) {\n\t\t\t\tevt.target.classList.remove(\"mv-has-hovered-item\");\n\n\t\t\t\tvar parent = evt.target.parentNode.closest(_.selectors.item);\n\n\t\t\t\tif (parent) {\n\t\t\t\t\tparent.classList.toggle(\"mv-has-hovered-item\", evt.type == \"mouseenter\");\n\t\t\t\t}\n\t\t\t}\n\t\t}, true);\n\n\t\tthis.setUnsavedChanges();\n\t},\n\n\t/**\n\t * Set this mavo instance’s unsavedChanges flag.\n\t * @param {Boolean} [value]\n\t *        If true, just sets the flag to true, no traversal.\n\t *        If false, sets the flag of the Mavo instance and every tree node to false\n\t *        If not provided, traverses the tree and recalculates the flag value.\n\t */\n\tsetUnsavedChanges: function(value) {\n\t\tvar unsavedChanges = !!value;\n\n\t\tif (!value) {\n\t\t\tthis.walk(obj => {\n\t\t\t\tif (obj.unsavedChanges) {\n\t\t\t\t\tunsavedChanges = true;\n\n\t\t\t\t\tif (value === false) {\n\t\t\t\t\t\tobj.unsavedChanges = false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn this.unsavedChanges = unsavedChanges;\n\t},\n\n\t// Conclude editing\n\tdone: function() {\n\t\tthis.root.done();\n\t\t$.unbind(this.element, \".mavo:edit\");\n\t\tthis.unsavedChanges = false;\n\t},\n\n\t/**\n\t * load - Fetch data from source and render it.\n\t *\n\t * @return {Promise}  A promise that resolves when the data is loaded.\n\t */\n\tload: function() {\n\t\tthis.inProgress = \"Loading\";\n\n\t\tvar backend = this.storage || this.source;\n\n\t\treturn backend.ready.then(() => backend.get())\n\t\t.catch(err => {\n\t\t\t// Try again with source\n\t\t\tif (this.source && backend !== this.source) {\n\t\t\t\treturn this.source.ready.then(() => this.source.get());\n\t\t\t}\n\n\t\t\treturn Promise.reject(err);\n\t\t})\n\t\t.then(response => {\n\t\t\tif (response && $.type(response) == \"string\") {\n\t\t\t\tresponse = JSON.parse(response);\n\t\t\t}\n\n\t\t\tthis.render(response);\n\t\t})\n\t\t.catch(err => {\n\t\t\tif (err) {\n\t\t\t\tif (err.xhr && err.xhr.status == 404) {\n\t\t\t\t\tthis.render(\"\");\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// TODO display error to user\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t\tconsole.log(err.stack);\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t\t.then(() => {\n\t\t\tthis.inProgress = false;\n\t\t\t$.fire(this.element, \"mavo:load\");\n\t\t});\n\t},\n\n\tstore: function() {\n\t\tif (!this.storage) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.inProgress = \"Saving\";\n\n\t\tthis.storage.login()\n\t\t.then(() => this.storage.put())\n\t\t.then(file => {\n\t\t\t$.fire(this.element, \"mavo:save\", {\n\t\t\t\tdata: file.data,\n\t\t\t\tdataString: file.dataString\n\t\t\t});\n\n\t\t\tthis.lastSaved = Date.now();\n\t\t})\n\t\t.catch(err => {\n\t\t\tif (err) {\n\t\t\t\tconsole.error(err);\n\t\t\t\tconsole.log(err.stack);\n\t\t\t}\n\t\t})\n\t\t.then(() => {\n\t\t\tthis.inProgress = false;\n\t\t});\n\t},\n\n\tsave: function() {\n\t\tthis.root.save();\n\n\t\tthis.store();\n\n\t\tthis.unsavedChanges = false;\n\t},\n\n\trevert: function() {\n\t\tthis.root.revert();\n\t},\n\n\twalk: function(callback) {\n\t\tthis.root.walk(callback);\n\t},\n\n\tlive: {\n\t\tinProgress: function(value) {\n\t\t\t$.toggleAttribute(this.element, \"mv-progress\", value, value);\n\t\t},\n\n\t\tunsavedChanges: function(value) {\n\t\t\tthis.element.classList.toggle(\"mv-unsaved-changes\", value);\n\n\t\t\tif (this.ui && this.ui.save) {\n\t\t\t\tthis.ui.save.disabled = !value;\n\t\t\t\tthis.ui.revert.disabled = !value;\n\t\t\t}\n\t\t},\n\n\t\tneedsEdit: function(value) {\n\t\t\t$.toggleAttribute(this.ui.bar, \"hidden\", \"\", !value);\n\t\t}\n\t},\n\n\tstatic: {\n\t\tall: [],\n\n\t\tsuperKey: navigator.platform.indexOf(\"Mac\") === 0? \"metaKey\" : \"ctrlKey\",\n\n\t\tinit: function(container) {\n\t\t\treturn $$(_.selectors.init, container || document)\n\t\t\t\t.filter(element => !element.parentNode.closest(_.selectors.init))\n\t\t\t\t.map(element => new _(element));\n\t\t},\n\n\t\thooks: new $.Hooks(),\n\n\t\tattributes: [\n\t\t\t\"mv-app\", \"mv-storage\", \"mv-init\", \"mv-attribute\",\n\t\t\t\"mv-default\", \"mv-mode\", \"mv-edit\", \"mv-permisssions\"\n\t\t]\n\t}\n});\n\n{\n\nlet s = _.selectors = {\n\tinit: \".mv-app, [mv-app], [data-mv-app], [mv-storage], [data-mv-storage]\",\n\tproperty: \"[property], [itemprop]\",\n\tspecificProperty: name => `[property=${name}], [itemprop=${name}]`,\n\tgroup: \"[typeof], [itemscope], [itemtype], .mv-group\",\n\tmultiple: \"[mv-multiple], .mv-multiple\",\n\tformControl: \"input, select, option, textarea\",\n\titem: \".mv-item\",\n\tui: \".mv-ui\",\n\tcontainer: {\n\t\t\"li\": \"ul, ol\",\n\t\t\"tr\": \"table\",\n\t\t\"option\": \"select\",\n\t\t\"dt\": \"dl\",\n\t\t\"dd\": \"dl\"\n\t}\n};\n\nlet arr = s.arr = selector => selector.split(/\\s*,\\s*/g);\nlet not = s.not = selector => arr(selector).map(s => `:not(${s})`).join(\"\");\nlet or = s.or = (selector1, selector2) => selector1 + \", \" + selector2;\nlet and = s.and = (selector1, selector2) => {\n\tvar ret = [], arr2 = arr(selector2);\n\n\tarr(selector1).forEach(s1 => ret.push(...arr2.map(s2 => s1 + s2)));\n\n\treturn ret.join(\", \");\n};\nlet andNot = s.andNot = (selector1, selector2) => and(selector1, not(selector2));\n\n$.extend(_.selectors, {\n\tprimitive: andNot(s.property, s.group),\n\trootGroup: andNot(s.group, s.property),\n\toutput: or(s.specificProperty(\"output\"), \".mv-output, .mv-value\")\n});\n\n}\n\n// Init mavo\nPromise.all([\n\t$.ready(),\n\t$.include(Array.from && window.Intl && document.documentElement.closest, \"https://cdn.polyfill.io/v2/polyfill.min.js?features=blissfuljs,Intl.~locale.en\")\n])\n.catch(err => console.error(err))\n.then(() => Mavo.init());\n\nStretchy.selectors.filter = \".mv-editor:not([property])\";\n\n})(Bliss, Bliss.$);\n"],"sourceRoot":"/source/"}