{"version":3,"sources":["functions.js"],"names":[],"mappings":"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","file":"mavo.es5.js","sourcesContent":["/**\n * Functions available inside Mavo expressions\n */\n\n(function() {\n\nvar _ = Mavo.Functions = {\n\toperators: {\n\t\t\"=\": \"eq\"\n\t},\n\n\t/**\n\t * Aggregate sum\n\t */\n\tsum: function(array) {\n\t\treturn numbers(array, arguments).reduce((prev, current) => {\n\t\t\treturn +prev + (+current || 0);\n\t\t}, 0);\n\t},\n\n\t/**\n\t * Average of an array of numbers\n\t */\n\taverage: function(array) {\n\t\tarray = numbers(array, arguments);\n\n\t\treturn array.length && _.sum(array) / array.length;\n\t},\n\n\t/**\n\t * Min of an array of numbers\n\t */\n\tmin: function(array) {\n\t\treturn Math.min(...numbers(array, arguments));\n\t},\n\n\t/**\n\t * Max of an array of numbers\n\t */\n\tmax: function(array) {\n\t\treturn Math.max(...numbers(array, arguments));\n\t},\n\n\tcount: function(array) {\n\t\treturn Mavo.toArray(array).filter(a => a !== null && a !== false).length;\n\t},\n\n\tround: function(num, decimals) {\n\t\tif (!num || !decimals || !isFinite(num)) {\n\t\t\treturn Math.round(num);\n\t\t}\n\n\t\treturn +num.toLocaleString(\"en-US\", {\n\t\t\tuseGrouping: false,\n\t\t\tmaximumFractionDigits: decimals\n\t\t});\n\t},\n\n\tiff: function(condition, iftrue, iffalse=\"\") {\n\t\tif (Array.isArray(condition)) {\n\t\t\treturn condition.map((c, i) => {\n\t\t\t\tvar ret = c? iftrue : iffalse;\n\n\t\t\t\tif (Array.isArray(ret)) {\n\t\t\t\t\treturn ret[Math.min(i, ret.length - 1)];\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t});\n\t\t}\n\n\t\treturn condition? iftrue : iffalse;\n\t}\n};\n\n/**\n * Addition for elements and scalars.\n * Addition between arrays happens element-wise.\n * Addition between scalars returns their scalar sum (same as +)\n * Addition between a scalar and an array will result in the scalar being added to every array element.\n * Ordered by precedence (higher to lower)\n */\noperator(\"not\", a => a => !a);\noperator(\"multiply\", (a, b) => a * b, {identity: 1, symbol: \"*\"});\noperator(\"divide\", (a, b) => a / b, {identity: 1, symbol: \"/\"});\noperator(\"add\", (a, b) => +a + +b, {symbol: \"+\"});\noperator(\"subtract\", (a, b) => a - b, {symbol: \"-\"});\noperator(\"lte\", (a, b) => a <= b, {symbol: \"<=\"});\noperator(\"lt\", (a, b) => a < b, {symbol: \"<\"});\noperator(\"gte\", (a, b) => a >= b, {symbol: \">=\"});\noperator(\"gt\", (a, b) => a > b, {symbol: \">\"});\noperator(\"eq\", (a, b) => a == b, {symbol: \"==\"});\noperator(\"and\", (a, b) => !!a && !!b, { identity: true, symbol: \"&&\" });\noperator(\"or\", (a, b) => !!a || !!b, { identity: false, symbol: \"||\" } );\n\nvar aliases = {\n\taverage: \"avg\",\n\tiff: \"iff IF\",\n\tsubtract: \"minus\",\n\tmultiply: \"mult product\",\n\tdivide: \"div\",\n\tlt: \"lessThan smaller\",\n\tgt: \"moreThan greater greaterThan bigger\",\n\teq: \"equal equality\"\n};\n\nfor (let name in aliases) {\n\taliases[name].split(/\\s+/g).forEach(alias => _[alias] = _[name]);\n}\n\n// Make function names case insensitive\nMavo.Functions._Trap = self.Proxy? new Proxy(_, {\n\tget: (functions, property) => {\n\t\tif (property in functions) {\n\t\t\treturn functions[property];\n\t\t}\n\n\t\tvar propertyL = property.toLowerCase && property.toLowerCase();\n\n\t\tif (propertyL && functions.hasOwnProperty(propertyL)) {\n\t\t\treturn functions[propertyL];\n\t\t}\n\n\t\tif (property in Math || propertyL in Math) {\n\t\t\treturn Math[property] || Math[propertyL];\n\t\t}\n\n\t\tif (property in self) {\n\t\t\treturn self[property];\n\t\t}\n\n\t\t// Prevent undefined at all costs\n\t\treturn property;\n\t},\n\n\t// Super ugly hack, but otherwise data is not\n\t// the local variable it should be, but the string \"data\"\n\t// so all property lookups fail.\n\thas: (functions, property) => property != \"data\"\n}) : Mavo.Functions;\n\n/**\n * Private helper methods\n */\nfunction numbers(array, args) {\n\tarray = Array.isArray(array)? array : (args? $$(args) : [array]);\n\n\treturn array.filter(number => !isNaN(number)).map(n => +n);\n}\n\n/**\n * Extend a scalar operator to arrays, or arrays and scalars\n * The operation between arrays is applied element-wise.\n * The operation operation between a scalar and an array will result in\n * the operation being applied between the scalar and every array element.\n * @param op {Function} The operation between two scalars\n * @param identity The operationâ€™s identity element. Defaults to 0.\n */\nfunction operator(name, op, o = {}) {\n\tif (op.length < 2) {\n\t\t// Unary operator\n\t\treturn operand => Array.isArray(operand)? operand.map(op) : op(operand);\n\t}\n\n\tif (o.symbol) {\n\t\t_.operators[o.symbol] = name;\n\t}\n\n\treturn _[name] = function(...operands) {\n\t\tif (operands.length === 1) {\n\t\t\toperands = [...operands, o.identity];\n\t\t}\n\n\t\treturn operands.reduce((a, b) => {\n\t\t\tif (Array.isArray(b)) {\n\t\t\t\tif (typeof o.identity == \"number\") {\n\t\t\t\t\tb = numbers(b);\n\t\t\t\t}\n\n\t\t\t\tif (Array.isArray(a)) {\n\t\t\t\t\treturn [\n\t\t\t\t\t\t...b.map((n, i) => op(a[i] === undefined? o.identity : a[i], n)),\n\t\t\t\t\t\t...a.slice(b.length)\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn b.map(n => op(a, n));\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Operand is scalar\n\t\t\t\tif (typeof o.identity == \"number\") {\n\t\t\t\t\tb = +b;\n\t\t\t\t}\n\n\t\t\t\tif (Array.isArray(a)) {\n\t\t\t\t\treturn a.map(n => op(n, b));\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn op(a, b);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n}\n\n})();\n"],"sourceRoot":"/source/"}