{"version":3,"sources":["debug.js"],"names":[],"mappings":"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","file":"mavo.es5.js","sourcesContent":["(function($, $$) {\n\nvar _ = Mavo.Debug = {\n\tfriendlyError: (e, expr) => {\n\t\tvar type = e.constructor.name.replace(/Error$/, \"\").toLowerCase();\n\t\tvar message = e.message;\n\n\t\t// Friendlify common errors\n\n\t\t// Non-developers don't know wtf a token is.\n\t\tmessage = message.replace(/\\s+token\\s+/g, \" \");\n\n\t\tif (message == \"Unexpected }\" && !/[{}]/.test(expr)) {\n\t\t\tmessage = \"Missing a )\";\n\t\t}\n\t\telse if (message === \"Unexpected )\") {\n\t\t\tmessage = \"Missing a (\";\n\t\t}\n\t\telse if (message === \"Invalid left-hand side in assignment\") {\n\t\t\tmessage = \"Invalid assignment. Maybe you typed = instead of == ?\";\n\t\t}\n\t\telse if (message == \"Unexpected ILLEGAL\") {\n\t\t\tmessage = \"There is an invalid character somewhere.\";\n\t\t}\n\n\t\treturn `<span class=\"type\">Oh noes, a ${type} error!</span> ${message}`;\n\t},\n\n\telementLabel: function(element, attribute) {\n\t\tvar ret = element.nodeName.toLowerCase();\n\n\t\tif (element.hasAttribute(\"property\")) {\n\t\t\tret += `[property=${element.getAttribute(\"property\")}]`;\n\t\t}\n\t\telse if (element.id) {\n\t\t\tret += `#${element.id}`;\n\t\t}\n\t\telse if (element.classList.length) {\n\t\t\tret += $$(element.classList).map(c => `.${c}`).join(\"\");\n\t\t}\n\n\t\tif (attribute) {\n\t\t\tret += `@${attribute}`;\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\tprintValue: function(obj) {\n\t\tvar ret;\n\n\t\tif (typeof obj !== \"object\" || obj === null) {\n\t\t\treturn typeof obj == \"string\"? `\"${obj}\"` : obj + \"\";\n\t\t}\n\n\t\tif (Array.isArray(obj)) {\n\t\t\tif (obj.length > 0) {\n\t\t\t\tif (typeof obj[0] === \"object\") {\n\t\t\t\t\treturn `List: ${obj.length} group(s)`;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn \"List: \" + obj.map(_.printValue).join(\", \");\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn \"List: (Empty)\";\n\t\t\t}\n\t\t}\n\n\t\tif (obj.constructor === Object) {\n\t\t\treturn `Group with ${Object.keys(obj).length} properties`;\n\t\t}\n\n\t\tif (obj instanceof Mavo.Primitive) {\n\t\t\treturn _.printValue(obj.value);\n\t\t}\n\t\telse if (obj instanceof Mavo.Collection) {\n\t\t\tif (obj.children.length > 0) {\n\t\t\t\tif (obj.children[0] instanceof Mavo.Group) {\n\t\t\t\t\treturn `List: ${obj.children.length} group(s)`;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn \"List: \" + obj.children.map(_.printValue).join(\", \");\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn _.printValue([]);\n\t\t\t}\n\t\t}\n\t\telse if (obj instanceof Mavo.Group) {\n\t\t\t// Group\n\t\t\treturn `Group with ${Object.keys(obj).length} properties`;\n\t\t}\n\t},\n\n\ttimed: function(id, callback) {\n\t\treturn function() {\n\t\t\tconsole.time(id);\n\t\t\tcallback.apply(this, arguments);\n\t\t\tconsole.timeEnd(id);\n\t\t};\n\t},\n\n\ttime: function callee(objName, name) {\n\t\tvar obj = eval(objName);\n\t\tvar callback = obj[name];\n\n\t\tobj[name] = function callee() {\n\t\t\tvar before = performance.now();\n\t\t\tvar ret = callback.apply(this, arguments);\n\t\t\tcallee.timeTaken += performance.now() - before;\n\t\t\tobj[name].calls++;\n\t\t\treturn ret;\n\t\t};\n\n\t\tobj[name].timeTaken = obj[name].calls = 0;\n\n\t\tcallee.all = callee.all || [];\n\t\tcallee.all.push({obj, objName, name});\n\n\t\treturn obj[name];\n\t},\n\n\ttimes: function() {\n\t\tif (!_.time.all) {\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.table(_.time.all.map(o => {\n\t\t\treturn {\n\t\t\t\t\"Function\": `${o.objName}.${o.name}`,\n\t\t\t\t\"Time (ms)\": o.obj[o.name].timeTaken,\n\t\t\t\t\"Calls\": o.obj[o.name].calls\n\t\t\t};\n\t\t}));\n\t},\n\n\treservedWords: \"as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield\".split(\"|\")\n};\n\nMavo.prototype.render = _.timed(\"render\", Mavo.prototype.render);\n\nMavo.selectors.debug = \".mv-debug\";\n\nvar selector = \", .mv-debuginfo\";\n\nStretchy.selectors.filter += selector;\n\n// Add element to show saved data\nMavo.hooks.add(\"init-tree-after\", function() {\n\tif (this.root.debug) {\n\t\tthis.element.classList.add(\"mv-debug-saving\");\n\t}\n\n\tif (this.store && this.element.classList.contains(\"mv-debug-saving\")) {\n\t\tvar element;\n\n\t\tvar details = $.create(\"details\", {\n\t\t\tclassName: \"mv-debug-storage\",\n\t\t\tcontents: [\n\t\t\t\t{tag: \"Summary\", textContent: \"Saved data\"},\n\t\t\t\telement = $.create(\"pre\", {id: this.id + \"-debug-storage\"})\n\t\t\t],\n\t\t\tafter: this.element\n\t\t});\n\n\t\tthis.element.addEventListener(\"mavo:save\", evt => {\n\t\t\telement.innerHTML = \"\";\n\n\t\t\telement.appendChild(prettyPrint(evt.data));\n\t\t});\n\t}\n});\n\nMavo.hooks.add(\"render-start\", function({data}) {\n\tif (this.backend && this.element.classList.contains(\"mv-debug-saving\")) {\n\t\tvar element = $(`#${this.id}-debug-storage`);\n\n\t\tif (element) {\n\t\t\telement.innerHTML = \"\";\n\n\t\t\tif (data) {\n\t\t\t\telement.appendChild(prettyPrint(data));\n\t\t\t}\n\t\t}\n\t}\n});\n\nMavo.hooks.add(\"group-init-start\", function() {\n\tthis.debug = this.debug || this.walkUp(group => {\n\t\tif (group.debug) {\n\t\t\treturn true;\n\t\t}\n\t}) || Mavo.Functions.urlOption(\"debug\") !== null;\n\n\tif (!this.debug && this.element.closest(Mavo.selectors.debug)) {\n\t\tthis.debug = true;\n\t}\n\n\tif (this.debug) {\n\t\tthis.debug = $.create(\"tbody\", {\n\t\t\tinside: $.create(\"table\", {\n\t\t\t\tinnerHTML: `<thead><tr>\n\t\t\t\t\t<th></th>\n\t\t\t\t\t<th>Expression</th>\n\t\t\t\t\t<th>Value</th>\n\t\t\t\t\t<th>Element</th>\n\t\t\t\t</tr></thead>`,\n\t\t\t\tstyle: {\n\t\t\t\t\tdisplay: \"none\"\n\t\t\t\t},\n\t\t\t\tinside: $.create(\"details\", {\n\t\t\t\t\tclassName: \"mv-ui mv-debuginfo\",\n\t\t\t\t\tinside: this.element,\n\t\t\t\t\tcontents: $.create(\"summary\", {\n\t\t\t\t\t\ttextContent: \"Debug\"\n\t\t\t\t\t}),\n\t\t\t\t\t\"mv-expressions\": \"none\"\n\t\t\t\t})\n\t\t\t})\n\t\t});\n\t}\n}, true);\n\nMavo.hooks.add(\"node-init-end\", function() {\n\tif (this.collection) {\n\t\tthis.debug = this.collection.debug;\n\t}\n});\n\nMavo.hooks.add(\"expressions-init-start\", function() {\n\tthis.debug = this.group.debug;\n});\n\nMavo.hooks.add(\"expression-eval-beforeeval\", function() {\n\tif (this.debug) {\n\t\tthis.debug.classList.remove(\"mv-error\");\n\t}\n});\n\nMavo.hooks.add(\"expression-eval-error\", function(env) {\n\tif (this.debug) {\n\t\tthis.debug.innerHTML = _.friendlyError(env.exception, env.expression);\n\t\tthis.debug.classList.add(\"mv-error\");\n\t}\n});\n\nMavo.Group.prototype.debugRow = function({element, attribute = null, tds = []}) {\n\tif (!this.debug) {\n\t\treturn;\n\t}\n\n\tthis.debug.parentNode.style.display = \"\";\n\n\tvar type = tds[0];\n\n\ttds[0] = $.create(\"td\", {\n\t\ttitle: type\n\t});\n\n\tif (!tds[3]) {\n\t\tvar elementLabel = _.elementLabel(element, attribute);\n\n\t\ttds[3] = $.create(\"td\", {\n\t\t\ttextContent: elementLabel,\n\t\t\ttitle: elementLabel,\n\t\t\tevents: {\n\t\t\t\t\"mouseenter mouseleave\": evt => {\n\t\t\t\t\telement.classList.toggle(\"mv-highlight\", evt.type === \"mouseenter\");\n\t\t\t\t},\n\t\t\t\t\"click\": evt => {\n\t\t\t\t\telement.scrollIntoView({behavior: \"smooth\"});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\ttds = tds.map(td => {\n\t\tif (!(td instanceof Node)) {\n\t\t\treturn $.create(\"td\", typeof td == \"object\"? td : { textContent: td });\n\t\t}\n\n\t\treturn td;\n\t});\n\n\tif (type == \"Warning\") {\n\t\ttds[1].setAttribute(\"colspan\", 2);\n\t}\n\n\tvar tr = $.create(\"tr\", {\n\t\tclassName: \"mv-debug-\" + type.toLowerCase(),\n\t\tcontents: tds,\n\t\tinside: this.debug\n\t});\n};\n\nMavo.hooks.add(\"expressiontext-init-end\", function() {\n\tif (this.group.debug) {\n\t\tthis.debug = {};\n\n\t\tthis.parsed.forEach(expr => {\n\t\t\tif (expr instanceof Mavo.Expression && !this.element.matches(\".mv-debuginfo *\")) {\n\t\t\t\tthis.group.debugRow({\n\t\t\t\t\telement: this.element,\n\t\t\t\t\tattribute: this.attribute,\n\t\t\t\t\ttds: [\"Expression\", {\n\t\t\t\t\t\t\ttag: \"td\",\n\t\t\t\t\t\t\tcontents: {\n\t\t\t\t\t\t\t\ttag: \"textarea\",\n\t\t\t\t\t\t\t\tvalue: expr.expression,\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tinput: evt => {\n\t\t\t\t\t\t\t\t\t\texpr.expression = evt.target.value;\n\t\t\t\t\t\t\t\t\t\texpr.debug = evt.target.parentNode.nextElementSibling;\n\t\t\t\t\t\t\t\t\t\tthis.update(this.data);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tonce: {\n\t\t\t\t\t\t\t\t\tfocus: evt => Stretchy.resize(evt.target)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\texpr.debug = $.create(\"td\")\n\t\t\t\t\t]\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n\nMavo.hooks.add(\"group-init-end\", function() {\n\t// TODO make properties update, collapse duplicate expressions\n\tif (this.debug instanceof Node) {\n\t\t// We have a debug table, add stuff to it\n\n\t\tvar selector = Mavo.selectors.andNot(Mavo.selectors.multiple, Mavo.selectors.property);\n\t\t$$(selector, this.element).forEach(element => {\n\t\t\tthis.debugRow({\n\t\t\t\telement,\n\t\t\t\ttds: [\"Warning\", \"mv-multiple without a property attribute\"]\n\t\t\t});\n\t\t});\n\n\t\tthis.propagate(obj => {\n\t\t\tvar value = _.printValue(obj);\n\n\t\t\tthis.debugRow({\n\t\t\t\telement: obj.element,\n\t\t\t\ttds: [\"Property\", obj.property, obj.value]\n\t\t\t});\n\n\t\t\tif (_.reservedWords.indexOf(obj.property) > -1) {\n\t\t\t\tthis.debugRow({\n\t\t\t\t\telement: obj.element,\n\t\t\t\t\ttds: [\"Warning\", `You can’t use \"${obj.property}\" as a property name, it’s a reserved word.`]\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (/^\\d|[\\W$]/.test(obj.property)) {\n\t\t\t\tthis.debugRow({\n\t\t\t\t\telement: obj.element,\n\t\t\t\t\ttds: [\"Warning\", {\n\t\t\t\t\t\ttextContent: `You can’t use \"${obj.property}\" as a property name.`,\n\t\t\t\t\t\ttitle: \"Property names can only contain letters, numbers and underscores and cannot start with a number.\"\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.group.element.addEventListener(\"mavo:datachange\", evt => {\n\t\t\t$$(\"tr.debug-property\", this.debug).forEach(tr => {\n\t\t\t\tvar property = tr.cells[1].textContent;\n\t\t\t\tvar value = _.printValue(this.children[property]);\n\n\t\t\t\tif (tr.cells[2]) {\n\t\t\t\t\tvar td = tr.cells[2];\n\t\t\t\t\ttd.textContent = td.title = value;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n\nMavo.hooks.add(\"expressiontext-update-beforeeval\", function(env) {\n\tif (this.debug) {\n\t\tenv.td = env.expr.debug;\n\n\t\tif (env.td) {\n\t\t\tenv.td.classList.remove(\"mv-error\");\n\t\t}\n\t}\n});\n\nMavo.hooks.add(\"expressiontext-update-aftereval\", function(env) {\n\tif (env.td && !env.td.classList.contains(\"mv-error\")) {\n\t\tvar value = _.printValue(env.value);\n\t\tenv.td.textContent = env.td.title = value;\n\t}\n});\n\n// Mavo.Debug.time(\"Mavo.Expressions.prototype\", \"update\");\n\n})(Bliss, Bliss.$);\n"],"sourceRoot":"/source/"}