{"version":3,"sources":["expression.js"],"names":[],"mappings":"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","file":"mavo.es5.js","sourcesContent":["(function($, $$) {\n\nvar _ = Mavo.Expression = $.Class({\n\tconstructor: function(expression) {\n\t\tthis.expression = expression;\n\t},\n\n\teval: function(data) {\n\t\tthis.oldValue = this.value;\n\n\t\t// TODO convert to new Function() which is more optimizable by JS engines.\n\t\t// Also, cache the function, since only data changes across invocations.\n\t\tMavo.hooks.run(\"expression-eval-beforeeval\", this);\n\n\t\ttry {\n\t\t\tif (!this.function) {\n\t\t\t\tthis.function = _.compile(this.expression);\n\t\t\t}\n\n\t\t\tthis.value = this.function(data);\n\t\t}\n\t\tcatch (exception) {\n\t\t\tMavo.hooks.run(\"expression-eval-error\", {context: this, exception});\n\n\t\t\tthis.value = _.ERROR;\n\t\t}\n\n\t\treturn this.value;\n\t},\n\n\ttoString() {\n\t\treturn this.expression;\n\t},\n\n\tlive: {\n\t\texpression: function(value) {\n\t\t\tvar code = value = value.trim();\n\n\t\t\tthis.function = null;\n\t\t}\n\t},\n\n\tstatic: {\n\t\tERROR: \"N/A\",\n\n\t\tserializers: {\n\t\t\t\"BinaryExpression\": node => `${_.serialize(node.left)} ${node.operator} ${_.serialize(node.right)}`,\n\t\t\t\"UnaryExpression\": node => `${node.operator}${_.serialize(node.argument)}`,\n\t\t\t\"CallExpression\": node => `${_.serialize(node.callee)}(${node.arguments.map(_.serialize).join(\", \")})`,\n\t\t\t\"ConditionalExpression\": node => `${_.serialize(node.test)}? ${_.serialize(node.consequent)} : ${_.serialize(node.alternate)}`,\n\t\t\t\"MemberExpression\": node => `${_.serialize(node.object)}[${_.serialize(node.property)}]`,\n\t\t\t\"ArrayExpression\": node => `[${node.elements.map(_.serialize).join(\", \")}]`,\n\t\t\t\"Literal\": node => node.raw,\n\t\t\t\"Identifier\": node => node.name,\n\t\t\t\"ThisExpression\": node => \"this\",\n\t\t\t\"Compound\": node => node.body.map(_.serialize).join(\" \")\n\t\t},\n\n\t\ttransformations: {\n\t\t\t\"BinaryExpression\": node => `${Mavo.Functions.operators[node.operator] || node.operator}(${_.serialize(node.left)}, ${_.serialize(node.right)})`,\n\t\t\t\"CallExpression\": node => {\n\t\t\t\tif (node.callee.type == \"Identifier\" && node.callee.name == \"if\") {\n\t\t\t\t\tnode.callee.name = \"iff\";\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tserialize: node => {\n\t\t\tif (_.transformations[node.type]) {\n\t\t\t\tvar ret = _.transformations[node.type](node);\n\n\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn _.serializers[node.type](node);\n\t\t},\n\n\t\trewrite: function(code) {\n\t\t\ttry {\n\t\t\t\treturn _.serialize(_.parse(code));\n\t\t\t}\n\t\t\tcatch (e) {\n\t\t\t\treturn code;\n\t\t\t}\n\t\t},\n\n\t\tcompile: function(code) {\n\t\t\tcode = _.rewrite(code);\n\n\t\t\treturn new Function(\"data\", `with(Mavo.Functions._Trap)\n\t\t\t\t\twith(data) {\n\t\t\t\t\t\treturn ${code};\n\t\t\t\t\t}`);\n\t\t},\n\n\t\tparse: self.jsep,\n\n\t\tlazy: {\n\t\t\tsimpleOperation: function() {\n\t\t\t\tvar operator = Object.keys(Mavo.Functions.operators).map(o => o.replace(/[|*+]/g, \"\\\\$&\")).join(\"|\");\n\t\t\t\tvar operand = \"\\\\s*(\\\\b[\\\\w.]+\\\\b)\\\\s*\";\n\n\t\t\t\treturn RegExp(`(?:^|\\\\()${operand}(${operator})${operand}(?:$|\\\\))`, \"g\");\n\t\t\t}\n\t\t}\n\t}\n});\n\nif (self.jsep) {\n\tjsep.addBinaryOp(\"and\", 2);\n\tjsep.addBinaryOp(\"or\", 2);\n}\n\n_.serializers.LogicalExpression = _.serializers.BinaryExpression;\n_.transformations.LogicalExpression = _.transformations.BinaryExpression;\n\n(function() {\n\nvar _ = Mavo.Expression.Text = $.Class({\n\tconstructor: function(o) {\n\t\tthis.all = o.all; // the Mavo.Expressions object that this belongs to\n\t\tthis.node = o.node;\n\t\tthis.path = o.path;\n\t\tthis.syntax = o.syntax;\n\n\t\tif (!this.node) {\n\t\t\t// No node provided, figure it out from path\n\t\t\tthis.node = this.path.reduce((node, index) => {\n\t\t\t\treturn node.childNodes[index];\n\t\t\t}, this.all.scope.element);\n\t\t}\n\n\t\tthis.element = this.node;\n\n\t\tthis.attribute = o.attribute || null;\n\n\t\tif (this.node.nodeType === 3) {\n\t\t\tthis.element = this.node.parentNode;\n\n\t\t\t// If no element siblings make this.node the element, which is more robust\n\t\t\t// Same if attribute, there are no attributes on a text node!\n\t\t\tif (!this.node.parentNode.children.length || this.attribute) {\n\t\t\t\tthis.node = this.element;\n\t\t\t\tthis.element.normalize();\n\t\t\t}\n\t\t}\n\n\t\tthis.expression = (this.attribute? this.node.getAttribute(this.attribute) : this.node.textContent).trim();\n\t\tthis.template = o.template? o.template.template : this.tokenize(this.expression);\n\n\t\t// Is this a computed property?\n\t\tvar primitive = Mavo.Unit.get(this.element);\n\t\tif (primitive && this.attribute === primitive.attribute) {\n\t\t\tthis.primitive = primitive;\n\t\t\tprimitive.computed = true; // Primitives containing an expression as their value are implicitly computed\n\t\t}\n\n\t\tMavo.hooks.run(\"expressiontext-init-end\", this);\n\n\t\t_.elements.set(this.element, [...(_.elements.get(this.element) || []), this]);\n\t},\n\n\tupdate: function(data) {\n\t\tthis.data = data;\n\n\t\tvar ret = {};\n\n\t\tret.value = this.value = this.template.map(expr => {\n\t\t\tif (expr instanceof Mavo.Expression) {\n\t\t\t\tvar env = {context: this, expr};\n\n\t\t\t\tMavo.hooks.run(\"expressiontext-update-beforeeval\", env);\n\n\t\t\t\tenv.value = env.expr.eval(data);\n\n\t\t\t\tMavo.hooks.run(\"expressiontext-update-aftereval\", env);\n\n\t\t\t\tif (env.value === undefined || env.value === null) {\n\t\t\t\t\t// Don’t print things like \"undefined\" or \"null\"\n\t\t\t\t\treturn \"\";\n\t\t\t\t}\n\n\t\t\t\treturn env.value;\n\t\t\t}\n\n\t\t\treturn expr;\n\t\t});\n\n\t\tif (!this.attribute) {\n\t\t\t// Separate presentational & actual values only apply when content is variable\n\t\t\tret.presentational = this.value.map(value => {\n\t\t\t\tif (Array.isArray(value)) {\n\t\t\t\t\treturn value.join(\", \");\n\t\t\t\t}\n\n\t\t\t\tif (typeof value == \"number\") {\n\t\t\t\t\treturn Mavo.Primitive.formatNumber(value);\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t});\n\n\t\t\tret.presentational = ret.presentational.length === 1? ret.presentational[0] : ret.presentational.join(\"\");\n\t\t}\n\n\t\tret.value = ret.value.length === 1? ret.value[0] : ret.value.join(\"\");\n\n\t\tif (this.primitive && this.template.length === 1) {\n\t\t\tif (typeof ret.value === \"number\") {\n\t\t\t\tthis.primitive.datatype = \"number\";\n\t\t\t}\n\t\t\telse if (typeof ret.value === \"boolean\") {\n\t\t\t\tthis.primitive.datatype = \"boolean\";\n\t\t\t}\n\t\t}\n\n\t\tif (ret.presentational === ret.value) {\n\t\t\tret = ret.value;\n\t\t}\n\n\t\tif (this.primitive) {\n\t\t\tthis.primitive.value = ret;\n\t\t}\n\t\telse {\n\t\t\tMavo.Primitive.setValue(this.node, ret, this.attribute, {presentational: ret.presentational});\n\t\t}\n\t},\n\n\ttokenize: function(template) {\n\t\tvar regex = this.syntax;\n\t\tvar match, ret = [], lastIndex = 0;\n\n\t\tthis.syntax.lastIndex = 0;\n\n\t\twhile ((match = this.syntax.exec(template)) !== null) {\n\t\t\t// Literal before the expression\n\t\t\tif (match.index > lastIndex) {\n\t\t\t\tret.push(template.substring(lastIndex, match.index));\n\t\t\t}\n\n\t\t\tlastIndex = this.syntax.lastIndex;\n\n\t\t\tret.push(new Mavo.Expression(match[1]));\n\t\t}\n\n\t\t// Literal at the end\n\t\tif (lastIndex < template.length) {\n\t\t\tret.push(template.substring(lastIndex));\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\tproxy: {\n\t\tscope: \"all\",\n\t\texpressionRegex: \"all\"\n\t},\n\n\tstatic: {\n\t\telements: new WeakMap()\n\t}\n});\n\n})();\n\n(function() {\n\nvar _ = Mavo.Expressions = $.Class({\n\tconstructor: function(scope) {\n\t\tif (scope) {\n\t\t\tthis.scope = scope;\n\t\t\tthis.scope.expressions = this;\n\t\t}\n\n\t\tthis.all = []; // all Expression.Text objects in this scope\n\n\t\tMavo.hooks.run(\"expressions-init-start\", this);\n\n\t\tif (this.scope) {\n\t\t\tvar template = this.scope.template;\n\n\t\t\tif (template && template.expressions) {\n\t\t\t\t// We know which expressions we have, don't traverse again\n\t\t\t\tfor (let et of template.expressions.all) {\n\t\t\t\t\tthis.all.push(new Mavo.Expression.Text({\n\t\t\t\t\t\tpath: et.path,\n\t\t\t\t\t\tsyntax: et.syntax,\n\t\t\t\t\t\tattribute: et.attribute,\n\t\t\t\t\t\tall: this,\n\t\t\t\t\t\ttemplate: et\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar syntax = _.getSyntax(this.scope.element.closest(\"[data-expressions]\")) || _.defaultSyntax;\n\t\t\t\tthis.traverse(this.scope.element, undefined, syntax);\n\t\t\t}\n\t\t}\n\n\t\tthis.dependents = new Set();\n\n\t\tthis.active = true;\n\n\t\t// Watch changes and update value\n\t\tthis.scope.element.addEventListener(\"mavo:datachange\", evt => this.update());\n\n\t\tthis.update();\n\t},\n\n\t/**\n\t * Update all expressions in this scope\n\t */\n\tupdate: function callee() {\n\t\tif (!this.active || this.scope.isDeleted() || this.all.length + this.dependents.size === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar env = { context: this, data: this.scope.getRelativeData() };\n\n\t\tMavo.hooks.run(\"expressions-update-start\", env);\n\n\t\tfor (let ref of this.all) {\n\t\t\tref.update(env.data);\n\t\t}\n\n\t\tfor (let exp of this.dependents) {\n\t\t\texp.update();\n\t\t}\n\t},\n\n\textract: function(node, attribute, path, syntax) {\n\t\tsyntax.lastIndex = 0;\n\n\t\tif (syntax.test(attribute? attribute.value : node.textContent)) {\n\t\t\tthis.all.push(new Mavo.Expression.Text({\n\t\t\t\tnode, syntax,\n\t\t\t\tpath: (path || \"\").slice(1).split(\"/\").map(i => +i),\n\t\t\t\tattribute: attribute && attribute.name,\n\t\t\t\tall: this\n\t\t\t}));\n\t\t}\n\t},\n\n\t// Traverse an element, including attribute nodes, text nodes and all descendants\n\ttraverse: function(node, path = \"\", syntax) {\n\t\tif (node.nodeType === 3 || node.nodeType === 8) { // Text node\n\t\t\t// Leaf node, extract references from content\n\t\t\tthis.extract(node, null, path, syntax);\n\t\t}\n\t\t// Traverse children and attributes as long as this is NOT the root of a child scope\n\t\t// (otherwise, it will be taken care of its own Expressions object)\n\t\telse if (node == this.scope.element || !Mavo.is(\"scope\", node)) {\n\t\t\tsyntax = _.getSyntax(node) || syntax;\n\t\t\t$$(node.attributes).forEach(attribute => this.extract(node, attribute, path, syntax));\n\t\t\t$$(node.childNodes).forEach((child, i) => this.traverse(child, `${path}/${i}`, syntax));\n\t\t}\n\t},\n\n\tstatic: {\n\t\tdefaultSyntax: /\\[([\\S\\s]+?)\\]/gi,\n\t\temptySyntax: /(?!)/,\n\n\t\tgetSyntax: function(element) {\n\t\t\tif (element) {\n\t\t\t\tvar syntax = element.getAttribute(\"data-expressions\");\n\n\t\t\t\tif (syntax) {\n\t\t\t\t\tif (/^\\S+expression\\S+$/i.test(syntax)) {\n\t\t\t\t\t\tsyntax = Mavo.escapeRegExp(syntax).replace(\"expression\", \"([\\\\S\\\\s]+?)\");\n\t\t\t\t\t\tsyntax = RegExp(syntax, \"gi\");\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\treturn _.emptySyntax; // empty set regex\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn syntax;\n\t\t\t}\n\t\t}\n\t}\n});\n\n})();\n\nMavo.Node.prototype.getRelativeData = function(o = { dirty: true, computed: true, null: true }) {\n\to.unhandled = this.mavo.unhandled;\n\tvar ret = this.getData(o);\n\n\tif (self.Proxy && ret && typeof ret === \"object\") {\n\t\tret = new Proxy(ret, {\n\t\t\tget: (data, property) => {\n\t\t\t\tif (property in data) {\n\t\t\t\t\treturn data[property];\n\t\t\t\t}\n\n\t\t\t\tif (property == \"$index\") {\n\t\t\t\t\treturn this.index + 1;\n\t\t\t\t}\n\n\t\t\t\t// Look in ancestors\n\t\t\t\tvar ret = this.walkUp(scope => {\n\t\t\t\t\tif (property in scope.properties) {\n\t\t\t\t\t\t// TODO decouple\n\t\t\t\t\t\tscope.expressions.dependents.add(this.expressions);\n\n\t\t\t\t\t\treturn scope.properties[property].getRelativeData(o);\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\thas: (data, property) => {\n\t\t\t\tif (property in data) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// Property does not exist, look for it elsewhere\n\t\t\t\tif (property == \"$index\") {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// First look in ancestors\n\t\t\t\tvar ret = this.walkUp(scope => {\n\t\t\t\t\tif (property in scope.properties) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\n\t\t\t\t// Still not found, look in descendants\n\t\t\t\tret = this.find(property);\n\n\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\tif (Array.isArray(ret)) {\n\t\t\t\t\t\tret = ret.map(item => item.getData(o))\n\t\t\t\t\t\t\t\t .filter(item => item !== null);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tret = ret.getData(o);\n\t\t\t\t\t}\n\n\t\t\t\t\tdata[property] = ret;\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tset: function(data, property, value) {\n\t\t\t\tthrow Error(\"You can’t set data via expressions.\");\n\t\t\t}\n\t\t});\n\t}\n\n\treturn ret;\n};\n\nMavo.hooks.add(\"scope-init-end\", function() {\n\tnew Mavo.Expressions(this);\n\tthis.expressions.update();\n});\n\nMavo.hooks.add(\"scope-render-start\", function() {\n\tthis.expressions.active = false;\n});\n\nMavo.hooks.add(\"scope-render-end\", function() {\n\trequestAnimationFrame(() => {\n\t\tthis.expressions.active = true;\n\t\tthis.expressions.update();\n\t});\n});\n\n})(Bliss, Bliss.$);\n"],"sourceRoot":"/source/"}