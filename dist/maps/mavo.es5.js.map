{"version":3,"sources":["collection.js"],"names":[],"mappings":"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","file":"mavo.es5.js","sourcesContent":["(function($, $$) {\n\nMavo.attributes.push(\"mv-multiple\", \"mv-order\");\n\nvar _ = Mavo.Collection = $.Class({\n\textends: Mavo.Node,\n\tnodeType: \"Collection\",\n\tconstructor: function (element, mavo, o) {\n\t\t/*\n\t\t * Create the template, remove it from the DOM and store it\n\t\t */\n\t\tthis.templateElement = this.element;\n\n\t\tthis.children = [];\n\n\t\t// ALL descendant property names as an array\n\t\tif (!this.fromTemplate(\"properties\", \"mutable\", \"templateElement\")) {\n\t\t\tthis.properties = $$(Mavo.selectors.property, this.templateElement).map(Mavo.Node.getProperty);\n\t\t\tthis.mutable = this.templateElement.matches(Mavo.selectors.multiple);\n\n\t\t\t// Must clone because otherwise once expressions are parsed on the template element\n\t\t\t// we will not be able to pick them up from subsequent items\n\t\t\tthis.templateElement = this.templateElement.cloneNode(true);\n\t\t}\n\n\t\tif (this.mutable) {\n\t\t\tvar item = this.createItem(this.element);\n\t\t\tthis.add(item);\n\t\t\tthis.itemTemplate = item.template || item;\n\t\t}\n\n\t\tMavo.hooks.run(\"collection-init-end\", this);\n\t},\n\n\tget length() {\n\t\treturn this.children.length;\n\t},\n\n\t// Collection still contains its template as data\n\tget containsTemplate() {\n\t\treturn this.children.length && this.children[0].element === this.element;\n\t},\n\n\tgetData: function(o = {}) {\n\t\tvar env = {\n\t\t\tcontext: this,\n\t\t\toptions: o,\n\t\t\tdata: []\n\t\t};\n\n\t\tfor (item of this.children) {\n\t\t\tif (!item.deleted) {\n\t\t\t\tlet itemData = item.getData(env.options);\n\n\t\t\t\tif (itemData) {\n\t\t\t\t\tenv.data.push(itemData);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.unhandled && env.options.unhandled) {\n\t\t\tenv.data = this.unhandled.before.concat(env.data, this.unhandled.after);\n\t\t}\n\n\t\tif (!this.mutable && env.data.length == 1) {\n\t\t\t// See https://github.com/LeaVerou/mavo/issues/50#issuecomment-266079652\n\t\t\tenv.data = env.data[0];\n\t\t}\n\n\t\tMavo.hooks.run(\"collection-getdata-end\", env);\n\n\t\treturn env.data;\n\t},\n\n\t// Create item but don't insert it anywhere\n\t// Mostly used internally\n\tcreateItem: function (element) {\n\t\tif (!element) {\n\t\t\telement = this.templateElement.cloneNode(true);\n\t\t}\n\n\t\tvar item = Mavo.Node.create(element, this.mavo, {\n\t\t\tcollection: this,\n\t\t\ttemplate: this.itemTemplate || (this.template? this.template.itemTemplate : null),\n\t\t\tproperty: this.property,\n\t\t\ttype: this.type\n\t\t});\n\n\t\treturn item;\n\t},\n\n\t/**\n\t * Add a new item to this collection\n\t * @param item {Node|Mavo.Node} Optional. Element or Mavo object for the new item\n\t * @param index {Number} Optional. Index of existing item, will be added opposite to list direction\n\t * @param silent {Boolean} Optional. Throw a datachange event? Mainly used internally.\n\t */\n\tadd: function(item, index, o = {}) {\n\t\tif (item instanceof Node) {\n\t\t\titem = Mavo.Node.get(item) || this.createItem(item);\n\t\t}\n\t\telse {\n\t\t\titem = item || this.createItem();\n\t\t}\n\n\t\tif (index in this.children) {\n\t\t\tif (this.bottomUp) {\n\t\t\t\tindex++;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tindex = this.bottomUp? 0 : this.length;\n\t\t}\n\n\t\tif (!item.element.parentNode) {\n\t\t\t// Add it to the DOM, if not already in\n\t\t\tvar nextItem = this.children[index];\n\n\t\t\titem.element._.before(nextItem && nextItem.element || this.marker);\n\t\t}\n\n\t\t// Update internal data model\n\t\tthis.children.splice(index, 0, item);\n\n\t\tfor (let i = index - 1; i < this.length; i++) {\n\t\t\tlet item = this.children[i];\n\n\t\t\tif (item) {\n\t\t\t\titem.index = i;\n\n\t\t\t\tif (!o.silent) {\n\t\t\t\t\titem.element._.fire(\"mavo:datachange\", {\n\t\t\t\t\t\tnode: this,\n\t\t\t\t\t\tmavo: this.mavo,\n\t\t\t\t\t\taction: \"add\",\n\t\t\t\t\t\titem\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!o.silent) {\n\t\t\tthis.unsavedChanges = item.unsavedChanges = this.mavo.unsavedChanges = true;\n\t\t}\n\n\t\treturn item;\n\t},\n\n\tdelete: function(item, hard) {\n\t\tif (hard) {\n\t\t\t// Hard delete\n\t\t\t$.remove(item.element);\n\t\t\tthis.children.splice(this.children.indexOf(item), 1);\n\t\t\treturn;\n\t\t}\n\n\t\treturn $.transition(item.element, {opacity: 0}).then(() => {\n\t\t\titem.deleted = true; // schedule for deletion\n\t\t\titem.element.style.opacity = \"\";\n\n\t\t\titem.element._.fire(\"mavo:datachange\", {\n\t\t\t\tnode: this,\n\t\t\t\tmavo: this.mavo,\n\t\t\t\taction: \"delete\",\n\t\t\t\titem: item\n\t\t\t});\n\n\t\t\tthis.unsavedChanges = item.unsavedChanges = this.mavo.unsavedChanges = true;\n\t\t});\n\t},\n\n\tedit: function() {\n\t\tthis.super.edit.call(this);\n\n\t\tif (this.mutable) {\n\t\t\t// Insert the add button if it's not already in the DOM\n\t\t\tif (!this.addButton.parentNode) {\n\t\t\t\tif (this.bottomUp) {\n\t\t\t\t\tthis.addButton._.before($.value(this.children[0], \"element\") || this.marker);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvar tag = this.element.tagName.toLowerCase();\n\t\t\t\t\tvar containerSelector = Mavo.selectors.container[tag];\n\n\t\t\t\t\tif (containerSelector) {\n\t\t\t\t\t\tvar after = this.marker.closest(containerSelector);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.addButton._.after(after && after.parentNode? after : this.marker);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tdone: function() {\n\t\tthis.super.done.call(this);\n\n\t\tif (this.mutable) {\n\t\t\tif (this.addButton.parentNode) {\n\t\t\t\tthis.addButton.remove();\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Delete all items in the collection.\n\t */\n\tclear: function() {\n\t\tif (this.mutable) {\n\t\t\tthis.propagate(item => {\n\t\t\t\tif (item.element.remove) {\n\t\t\t\t\titem.element.remove();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Document fragment, remove all children\n\t\t\t\t\tfor (let node of item.element.childNodes) {\n\t\t\t\t\t\tnode => node.remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.children = [];\n\n\t\t\tthis.marker._.fire(\"mavo:datachange\", {\n\t\t\t\tnode: this,\n\t\t\t\tmavo: this.mavo,\n\t\t\t\taction: \"clear\"\n\t\t\t});\n\t\t}\n\t},\n\n\tsave: function() {\n\t\tfor (let item of this.children) {\n\t\t\tif (item.deleted) {\n\t\t\t\tthis.delete(item, true);\n\t\t\t}\n\t\t\telse {\n\t\t\t\titem.unsavedChanges = false;\n\t\t\t}\n\t\t}\n\t},\n\n\tpropagated: [\"save\"],\n\n\trevert: function() {\n\t\tfor (let item of this.children) {\n\t\t\t// Delete added items\n\t\t\tif (item.unsavedChanges) {\n\t\t\t\tthis.delete(item, true);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Bring back deleted items\n\t\t\t\tif (item.deleted) {\n\t\t\t\t\titem.deleted = false;\n\t\t\t\t}\n\n\t\t\t\t// Revert all properties\n\t\t\t\titem.revert();\n\t\t\t}\n\t\t}\n\t},\n\n\trender: function(data) {\n\t\tthis.unhandled = {before: [], after: []};\n\n\t\tif (!data) {\n\t\t\treturn;\n\t\t}\n\n\t\tdata = Mavo.toArray(data);\n\n\t\tif (!this.mutable) {\n\t\t\tthis.children.forEach((item, i) => item.render(data && data[i]));\n\n\t\t\tif (data) {\n\t\t\t\tthis.unhandled.after = data.slice(this.children.length);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tthis.clear();\n\n\t\t\t// Using document fragments improved rendering performance by 60%\n\t\t\tvar fragment = document.createDocumentFragment();\n\n\t\t\tdata.forEach((datum, i) => {\n\t\t\t\tvar item = this.createItem();\n\n\t\t\t\titem.render(datum);\n\n\t\t\t\tthis.children.push(item);\n\t\t\t\titem.index = i;\n\n\t\t\t\tfragment.appendChild(item.element);\n\t\t\t});\n\n\t\t\tthis.marker.parentNode.insertBefore(fragment, this.marker);\n\t\t}\n\n\t\tthis.save();\n\t},\n\n\tfind: function(property) {\n\t\tvar items = this.children.filter(item => !item.deleted);\n\n\t\tif (this.property == property) {\n\t\t\treturn items;\n\t\t}\n\n\t\tif (this.properties.indexOf(property) > -1) {\n\t\t\tvar ret = items.map(item => item.find(property));\n\n\t\t\treturn Mavo.flatten(ret);\n\t\t}\n\t},\n\n\tlive: {\n\t\tmutable: function(value) {\n\t\t\tif (value && value !== this.mutable) {\n\t\t\t\t// Why is all this code here? Because we want it executed\n\t\t\t\t// every time mutable changes, not just in the constructor\n\t\t\t\t// (think multiple elements with the same property name, where only one has mv-multiple)\n\t\t\t\tthis._mutable = value;\n\n\t\t\t\tthis.mavo.needsEdit = true;\n\n\t\t\t\t// Keep position of the template in the DOM, since we might remove it\n\t\t\t\tthis.marker = $.create(\"div\", {\n\t\t\t\t\thidden: true,\n\t\t\t\t\tclassName: \"mv-marker\",\n\t\t\t\t\tafter: this.templateElement\n\t\t\t\t});\n\n\t\t\t\tthis.templateElement.classList.add(\"mv-item\");\n\t\t\t}\n\t\t}\n\t},\n\n\tlazy: {\n\t\tbottomUp: function() {\n\t\t\t/*\n\t\t\t * Add new items at the top or bottom?\n\t\t\t */\n\n\t\t\tif (!this.mutable) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar order = this.templateElement.getAttribute(\"mv-order\");\n\t\t\tif (order !== null) {\n\t\t\t\t// Attribute has the highest priority and overrides any heuristics\n\t\t\t\treturn /^desc\\b/i.test(order);\n\t\t\t}\n\n\t\t\tif (!this.addButton.parentNode) {\n\t\t\t\t// If add button not in DOM, do the default\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// If add button is already in the DOM and *before* our template, then we default to prepending\n\t\t\treturn !!(this.addButton.compareDocumentPosition(this.templateElement) & Node.DOCUMENT_POSITION_FOLLOWING);\n\t\t},\n\n\t\tclosestCollection: function() {\n\t\t\tvar parent = this.marker? this.marker.parentNode : this.templateElement.parentNode;\n\n\t\t\treturn parent.closest(Mavo.selectors.item);\n\t\t},\n\n\t\taddButton: function() {\n\t\t\t// Find add button if provided, or generate one\n\t\t\tvar selector = `button.mv-add-${this.property}`;\n\t\t\tvar group = this.closestCollection || this.marker.closest(Mavo.selectors.group);\n\n\t\t\tif (group) {\n\t\t\t\tvar button = $$(selector, group).filter(button => {\n\t\t\t\t\treturn !this.templateElement.contains(button);\n\t\t\t\t})[0];\n\t\t\t}\n\n\t\t\tif (!button) {\n\t\t\t\tbutton = $.create(\"button\", {\n\t\t\t\t\tclassName: \"mv-add\",\n\t\t\t\t\ttextContent: \"Add \" + this.name\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tbutton.classList.add(\"mv-ui\", \"mv-add\");\n\n\t\t\tif (this.property) {\n\t\t\t\tbutton.classList.add(`mv-add-${this.property}`);\n\t\t\t}\n\n\t\t\tbutton.addEventListener(\"click\", evt => {\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tthis.add().edit();\n\t\t\t});\n\n\t\t\treturn button;\n\t\t}\n\t}\n});\n\nMavo.hooks.add(\"primitive-init-end\", function() {\n\tif (this.collection && !this.attribute) {\n\t\t// Collection of primitives, deal with setting textContent etc without the UI interfering.\n\t\tvar swapUI = callback => {\n\t\t\tvar ret;\n\n\t\t\tthis.sneak(() => {\n\t\t\t\tvar ui = $.remove($(\".mv-item-controls\", this.element));\n\n\t\t\t\tret = callback();\n\n\t\t\t\t$.inside(ui, this.element);\n\t\t\t});\n\n\t\t\treturn ret;\n\t\t};\n\n\t\t// Intercept certain properties so that any Mavo UI inside this primitive will not be destroyed\n\t\t[\"textContent\", \"innerHTML\"].forEach(property => {\n\t\t\tvar descriptor = Object.getOwnPropertyDescriptor(Node.prototype, property);\n\n\t\t\tObject.defineProperty(this.element, property, {\n\t\t\t\tget: function() {\n\t\t\t\t\treturn swapUI(() => descriptor.get.call(this));\n\t\t\t\t},\n\n\t\t\t\tset: function(value) {\n\t\t\t\t\tswapUI(() => descriptor.set.call(this, value));\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n\nMavo.hooks.add(\"node-edit-end\", function() {\n\tif (this.collection) {\n\t\tif (!this.itemControls) {\n\t\t\tthis.itemControls = $$(\".mv-item-controls\", this.element)\n\t\t\t\t\t\t\t\t   .filter(el => el.closest(Mavo.selectors.item) == this.element)[0];\n\n\t\t\tthis.itemControls = this.itemControls || $.create({\n\t\t\t\tclassName: \"mv-item-controls mv-ui\"\n\t\t\t});\n\n\t\t\t$.set(this.itemControls, {\n\t\t\t\tcontents: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\ttitle: \"Delete this \" + this.name,\n\t\t\t\t\t\tclassName: \"mv-delete\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\"click\": evt => this.collection.delete(this)\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\ttitle: `Add new ${this.name.replace(/s$/i, \"\")} ${this.bottomUp? \"after\" : \"before\"}`,\n\t\t\t\t\t\tclassName: \"mv-add\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\"click\": evt => this.collection.add(null, this.children.indexOf(item)).edit()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t});\n\t\t}\n\n\t\tif (!this.itemControls.parentNode) {\n\t\t\tthis.element.appendChild(this.itemControls);\n\t\t}\n\t}\n});\n\nMavo.hooks.add(\"node-done-end\", function() {\n\tif (this.collection) {\n\t\tif (this.itemControls) {\n\t\t\tthis.itemControls.remove();\n\t\t}\n\t}\n});\n\n$.lazy(Mavo.Node.prototype, \"closestCollection\", function() {\n\tif (!this.group) {\n\t\tconsole.log(this.nodeType);\n\t}\n\treturn this.collection ||\n\t\t   this.group.collection ||\n\t\t   (this.parentGroup? this.parentGroup.closestCollection : null);\n});\n\n$.live(Mavo.Node.prototype, \"deleted\", function(value) {\n\tthis.element.classList.toggle(\"mv-deleted\", value);\n\n\tif (value) {\n\t\t// Soft delete, store element contents in a fragment\n\t\t// and replace them with an undo prompt.\n\t\tthis.elementContents = document.createDocumentFragment();\n\t\t$$(this.element.childNodes).forEach(node => {\n\t\t\tthis.elementContents.appendChild(node);\n\t\t});\n\n\t\t$.contents(this.element, [\n\t\t\t{\n\t\t\t\ttag: \"button\",\n\t\t\t\tclassName: \"mv-close mv-ui\",\n\t\t\t\ttextContent: \"×\",\n\t\t\t\tevents: {\n\t\t\t\t\t\"click\": function(evt) {\n\t\t\t\t\t\t$.remove(this.parentNode);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"Deleted \" + this.name,\n\t\t\t{\n\t\t\t\ttag: \"button\",\n\t\t\t\tclassName: \"mv-undo mv-ui\",\n\t\t\t\ttextContent: \"Undo\",\n\t\t\t\tevents: {\n\t\t\t\t\t\"click\": evt => this.deleted = false\n\t\t\t\t}\n\t\t\t}\n\t\t]);\n\n\t\tthis.element.classList.remove(\"mv-delete-hover\");\n\t}\n\telse if (this.deleted) {\n\t\t// Undelete\n\t\tthis.element.textContent = \"\";\n\t\tthis.element.appendChild(this.elementContents);\n\n\t\t// otherwise expressions won't update because this will still seem as deleted\n\t\t// Alternatively, we could fire datachange with a timeout.\n\t\tthis._deleted = false;\n\n\t\t$.fire(this.element, \"mavo:datachange\", {\n\t\t\tunit: this.collection,\n\t\t\tmavo: this.mavo,\n\t\t\taction: \"undelete\",\n\t\t\titem: this\n\t\t});\n\t}\n});\n\n/**\n * Check if this unit is either deleted or inside a deleted group\n */\nMavo.Node.prototype.isDeleted = function() {\n\tvar ret = this.deleted;\n\n\tif (this.deleted) {\n\t\treturn true;\n\t}\n\n\treturn !!this.parentGroup && this.parentGroup.isDeleted();\n};\n\nMavo.hooks.add(\"node-init-end\", function(env) {\n\tthis.collection = env.options.collection;\n\n\tif (this.collection) {\n\t\t// This is a collection item\n\t\tthis.group = this.parentGroup = this.collection.parentGroup;\n\t}\n});\n\n})(Bliss, Bliss.$);\n"],"sourceRoot":"/source/"}